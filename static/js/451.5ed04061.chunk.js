!function(){"use strict";var e={451:function(e,t,r){var n,s=r(5861),a=r(3433),i=r(5671),u=r(3144),c=r(7757),o=r.n(c);!function(e){var t;!function(e){e[e.FILE_IN=0]="FILE_IN",e[e.FILE_OUT=1]="FILE_OUT",e[e.PROGRESS_INIT=2]="PROGRESS_INIT",e[e.PROGRESS_UPDATE=3]="PROGRESS_UPDATE"}(t||(t={})),e.MessageType=t}(n||(n={}));var h=n,f=r(9439),p=r(7762),d=r(7449),x=function(){function e(t){(0,i.Z)(this,e),this.file=void 0,this.buffer=new ArrayBuffer(0),this.bufferOffset=0,this._offset=0,this.file=t}return(0,u.Z)(e,[{key:"getNextString",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.getNextBytes(t);case 3:r=e.sent,e.next=15;break;case 6:n=[];case 7:return e.next=9,this.getNextUint8();case 9:if(e.t0=s=e.sent,0===e.t0){e.next=14;break}n.push(s),e.next=7;break;case 14:r=new Uint8Array(n);case 15:return a=new TextDecoder,i=a.decode(r),e.abrupt("return",i);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNextUint8",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDataView(1);case 2:return t=e.sent,e.abrupt("return",t.getUint8(0));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNextUint16",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDataView(2);case 2:return t=e.sent,e.abrupt("return",t.getUint16(0));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNextUint32",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDataView(4);case 2:return t=e.sent,e.abrupt("return",t.getUint32(0));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNextUint64",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDataView(8);case 2:return t=e.sent,e.abrupt("return",t.getBigUint64(0));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNextBytes",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDataView(t);case 2:for(r=e.sent,n=new Uint8Array(t),s=0;s<t;s++)n[s]=r.getUint8(s);return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"seek",value:function(e){this._offset=e,(this._offset<this.bufferOffset||this._offset>this.bufferEndOffset)&&(this.buffer=new ArrayBuffer(0),this.bufferOffset=this._offset)}},{key:"skip",value:function(e){this._offset+=e}},{key:"offset",get:function(){return this._offset}},{key:"eof",get:function(){return this.offset>=this.file.size}},{key:"fillBuffer",value:function(){var t=(0,s.Z)(o().mark((function t(r){var n,s,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=this.offset+r)>this.bufferEndOffset)){t.next=8;break}return s=Math.floor(this.offset/e.BUFFER_SIZE)*e.BUFFER_SIZE,a=Math.ceil(n/e.BUFFER_SIZE)*e.BUFFER_SIZE,t.next=6,this.file.slice(s,a).arrayBuffer();case 6:this.buffer=t.sent,this.bufferOffset=s;case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getDataView",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fillBuffer(t);case 2:return r=new DataView(this.buffer,this.offset-this.bufferOffset,t),this._offset+=t,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"bufferEndOffset",get:function(){return this.bufferOffset+this.buffer.byteLength}}]),e}();x.BUFFER_SIZE=8388608;var l=function(){function e(t){(0,i.Z)(this,e),this.file=void 0,this.stream=void 0,this._offset=0,this._size=0,this.file=t}return(0,u.Z)(e,[{key:"writeNextUint8",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new Uint8Array(1))[0]=t,e.next=4,this.writeNextBytes(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeNextUint16",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ArrayBuffer(2),new DataView(r).setUint16(0,t,!1),e.next=5,this.writeNextBytes(r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeNextUint32",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ArrayBuffer(4),new DataView(r).setUint32(0,t,!1),e.next=5,this.writeNextBytes(r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeNextString",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(void 0!==r?r:t.length+1),(new TextEncoder).encodeInto(t,n),e.next=5,this.writeNextBytes(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"writeNextBytes",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStream();case 2:return r=e.sent,e.next=5,r.write(t);case 5:n=t instanceof Blob?t.size:t.byteLength,this._offset+=n,this._size+=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"skip",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.seek(this.offset+t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"seek",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStream();case 2:return r=e.sent,e.next=5,r.seek(t);case 5:this._offset=t;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStream();case 2:return t=e.sent,e.next=5,t.close();case 5:this.stream=void 0;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getStream",value:function(){var e=(0,s.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stream){e.next=8;break}return e.next=3,this.file.createWritable();case 3:return this.stream=e.sent,e.next=6,this.stream.truncate(0);case 6:this._size=0,this._offset=0;case 8:return e.abrupt("return",this.stream);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"offset",get:function(){return this._offset}},{key:"size",get:function(){return this._size}}]),e}(),m=r(136),v=r(9388);function y(e){return w.apply(this,arguments)}function w(){return(w=(0,s.Z)(o().mark((function e(t){var r,n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getNextUint32();case 2:return r=e.sent,e.next=5,t.getNextString(4);case 5:return n=e.sent,(s={"url ":j,"urn ":G,avc1:P,avcC:T,dinf:W,dref:L,ftyp:b,hdlr:q,mdat:N,mdhd:O,mdia:E,minf:F,moov:U,mvhd:B,stbl:D,stco:M,stsc:R,stsd:I,stss:z,stsz:H,stts:_,tkhd:C,trak:S,udta:V,vmhd:A})[n]?a=new s[n](t,r,n):(console.warn("No parser available for %c".concat(n),"text-decoration: underline"),a=new Q(t,r,n)),e.next=10,a.parse();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=function(){function e(t,r,n){(0,i.Z)(this,e),this.stream=void 0,this.size=void 0,this.type=void 0,this.header=void 0,this.stream=t,this.size=r,this.type=n,this.header=this.getHeader()}return(0,u.Z)(e,[{key:"getHeader",value:function(){var e=this.stream.offset-8,t=e+this.size;return{size:this.size,type:this.type,startOffset:e,endOffset:t}}},{key:"getChildBoxes",value:function(){var e=(0,s.Z)(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={};case 1:if(!(this.stream.offset<this.header.endOffset)){e.next=10;break}return e.next=4,this.getNextChildBox();case 4:"unknown"===(r=e.sent).type&&console.warn("Child box %c".concat(r.header.type,"%c in %c").concat(this.type,"%c is unknown, ignoring."),"text-decoration: underline","text-decoration: none","text-decoration: underline","text-decoration: none"),r.type in t||(t[r.type]=[]),t[r.type].push(r),e.next=1;break;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNextChildBox",value:function(){var e=(0,s.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(this.stream);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"seekToEnd",value:function(){if(this.stream.offset!==this.header.endOffset){var e=this.header.endOffset-this.stream.offset;console.warn("Box %c".concat(this.header.type,"%c was not fully parsed! Stopped ").concat(e,"B early."),"text-decoration: underline","text-decoration: none",this.header)}this.stream.seek(this.header.endOffset)}}]),e}(),g=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parse",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parseBox(this.header);case 2:return t=e.sent,this.seekToEnd(),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(k),Z=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"getFullBoxHeader",value:function(){var e=(0,s.Z)(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint8();case 2:return t=e.sent,e.next=5,this.stream.getNextUint8();case 5:return e.t0=e.sent,e.t1=e.t0<<16,e.next=9,this.stream.getNextUint8();case 9:return e.t2=e.sent,e.t3=e.t2<<8,e.t4=e.t1|e.t3,e.next=14,this.stream.getNextUint8();case 14:return e.t5=e.sent,r=e.t4|e.t5,e.abrupt("return",{version:t,flags:r});case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"parse",value:function(){var e=(0,s.Z)(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFullBoxHeader();case 2:return t=e.sent,e.next=5,this.parseBox(this.header,t);case 5:return r=e.sent,this.seekToEnd(),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(k),b=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextString(4);case 2:return r=e.sent,e.next=5,this.stream.getNextUint32();case 5:n=e.sent,s=[],a=0;case 8:if(!(a<(this.size-16)/4)){e.next=17;break}return e.t0=s,e.next=12,this.stream.getNextString(4);case 12:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 14:a++,e.next=8;break;case 17:return e.abrupt("return",{type:"ftyp",header:t,majorBrand:r,minorVersion:n,compatibleBrands:s});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),N=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stream.seek(this.header.endOffset),e.abrupt("return",{type:"mdat",header:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),U=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChildBoxes();case 2:return r=e.sent,e.abrupt("return",{type:"moov",header:t,mvhd:r.mvhd[0],trak:r.trak});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),B=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a,i,u,c,h,f,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.version){e.next=2;break}throw new Error("Version 1 not supported");case 2:return e.next=4,this.stream.getNextUint32();case 4:return n=e.sent,e.next=7,this.stream.getNextUint32();case 7:return s=e.sent,e.next=10,this.stream.getNextUint32();case 10:return a=e.sent,e.next=13,this.stream.getNextUint32();case 13:return i=e.sent,e.next=16,this.stream.getNextUint32();case 16:return u=e.sent,e.next=19,this.stream.getNextUint16();case 19:return c=e.sent,e.next=22,this.stream.getNextUint16();case 22:return e.next=24,this.stream.getNextUint32();case 24:return e.next=26,this.stream.getNextUint32();case 26:h=[],f=0;case 28:if(!(f<9)){e.next=37;break}return e.t0=h,e.next=32,this.stream.getNextUint32();case 32:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 34:f++,e.next=28;break;case 37:p=0;case 38:if(!(p<6)){e.next=44;break}return e.next=41,this.stream.getNextUint32();case 41:p++,e.next=38;break;case 44:return e.next=46,this.stream.getNextUint32();case 46:return d=e.sent,e.abrupt("return",{header:t,type:"mvhd",fullBoxHeader:r,creationTime:n,modificationTime:s,timescale:a,duration:i,rate:u,volume:c,matrix:h,nextTrackId:d});case 48:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),S=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChildBoxes();case 2:return r=e.sent,e.abrupt("return",{header:t,type:"trak",tkhd:r.tkhd[0],mdia:r.mdia[0]});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),C=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a,i,u,c,h,f,p,d,x;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.version){e.next=2;break}throw new Error("Version 1 not supported");case 2:return e.next=4,this.stream.getNextUint32();case 4:return n=e.sent,e.next=7,this.stream.getNextUint32();case 7:return s=e.sent,e.next=10,this.stream.getNextUint32();case 10:return a=e.sent,e.next=13,this.stream.getNextUint32();case 13:return e.next=15,this.stream.getNextUint32();case 15:return i=e.sent,e.next=18,this.stream.getNextUint32();case 18:return e.next=20,this.stream.getNextUint32();case 20:return e.next=22,this.stream.getNextUint16();case 22:return u=e.sent,e.next=25,this.stream.getNextUint16();case 25:return c=e.sent,e.next=28,this.stream.getNextUint16();case 28:return h=e.sent,e.next=31,this.stream.getNextUint16();case 31:f=[],p=0;case 33:if(!(p<9)){e.next=42;break}return e.t0=f,e.next=37,this.stream.getNextUint32();case 37:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 39:p++,e.next=33;break;case 42:return e.next=44,this.stream.getNextUint32();case 44:return e.t2=e.sent,d=e.t2>>16,e.next=48,this.stream.getNextUint32();case 48:return e.t3=e.sent,x=e.t3>>16,e.abrupt("return",{header:t,type:"tkhd",fullBoxHeader:r,creationTime:n,modificationTime:s,trackId:a,duration:i,layer:u,alternateGroup:c,volume:h,matrix:f,width:d,height:x});case 51:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),E=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChildBoxes();case 2:return r=e.sent,e.abrupt("return",{header:t,type:"mdia",mdhd:r.mdhd[0],minf:r.minf[0],hdlr:r.hdlr[0]});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),O=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a,i,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.version){e.next=2;break}throw new Error("Version 1 not supported");case 2:return e.next=4,this.stream.getNextUint32();case 4:return n=e.sent,e.next=7,this.stream.getNextUint32();case 7:return s=e.sent,e.next=10,this.stream.getNextUint32();case 10:return a=e.sent,e.next=13,this.stream.getNextUint32();case 13:return i=e.sent,u="",e.next=17,this.stream.getNextUint16();case 17:return e.next=19,this.stream.getNextUint16();case 19:return e.abrupt("return",{header:t,type:"mdhd",fullBoxHeader:r,creationTime:n,modificationTime:s,timescale:a,duration:i,language:u});case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),F=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChildBoxes();case 2:return r=e.sent,e.abrupt("return",{header:t,type:"minf",vmhd:"vmhd"in r?r.vmhd[0]:void 0,stbl:r.stbl[0],dinf:r.dinf[0]});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),D=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChildBoxes();case 2:return r=e.sent,e.abrupt("return",{header:t,type:"stbl",stco:r.stco[0],stsc:r.stsc[0],stsd:r.stsd[0],stss:r.stss[0],stsz:r.stsz[0],stts:r.stts[0]});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),I=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:n=e.sent,s=[],a=0;case 5:if(!(a<n)){e.next=13;break}return e.next=8,this.getNextChildBox();case 8:i=e.sent,s.push(i);case 10:a++,e.next=5;break;case 13:return e.abrupt("return",{header:t,type:"stsd",fullBoxHeader:r,entries:s});case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),P=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s,a,i,u,c,h,f,p,d,x;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<6)){e.next=7;break}return e.next=4,this.stream.getNextUint8();case 4:r++,e.next=1;break;case 7:return e.next=9,this.stream.getNextUint16();case 9:n=e.sent,s=0;case 11:if(!(s<2)){e.next=17;break}return e.next=14,this.stream.getNextUint16();case 14:s++,e.next=11;break;case 17:a=0;case 18:if(!(a<3)){e.next=24;break}return e.next=21,this.stream.getNextUint32();case 21:a++,e.next=18;break;case 24:return e.next=26,this.stream.getNextUint16();case 26:return i=e.sent,e.next=29,this.stream.getNextUint16();case 29:return u=e.sent,e.next=32,this.stream.getNextUint32();case 32:return c=e.sent,e.next=35,this.stream.getNextUint32();case 35:return h=e.sent,e.next=38,this.stream.getNextUint32();case 38:return e.next=40,this.stream.getNextUint16();case 40:return f=e.sent,e.next=43,this.stream.getNextString(32);case 43:return p=e.sent,e.next=46,this.stream.getNextUint16();case 46:return d=e.sent,e.next=49,this.stream.getNextUint16();case 49:return e.next=51,this.getNextChildBox();case 51:return x=e.sent,e.abrupt("return",{header:t,type:"avc1",avcC:x,compressorName:p,dataReferenceIndex:n,depth:d,frameCount:f,height:u,horizontalResolution:c,verticalResolution:h,width:i});case 53:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),T=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s,a,i,u,c,h,f,p,d,x,l,m,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint8();case 2:return r=e.sent,e.next=5,this.stream.getNextUint8();case 5:return n=e.sent,e.next=8,this.stream.getNextUint8();case 8:return s=e.sent,e.next=11,this.stream.getNextUint8();case 11:return a=e.sent,e.next=14,this.stream.getNextUint8();case 14:return e.t0=e.sent,i=3&e.t0,e.next=18,this.stream.getNextUint8();case 18:e.t1=e.sent,u=31&e.t1,c=[],h=0;case 22:if(!(h<u)){e.next=33;break}return e.next=25,this.stream.getNextUint16();case 25:return f=e.sent,e.next=28,this.stream.getNextBytes(f);case 28:p=e.sent,c.push(p);case 30:h++,e.next=22;break;case 33:return e.next=35,this.stream.getNextUint8();case 35:d=e.sent,x=[],l=0;case 38:if(!(l<d)){e.next=49;break}return e.next=41,this.stream.getNextUint16();case 41:return m=e.sent,e.next=44,this.stream.getNextBytes(m);case 44:v=e.sent,x.push(v);case 46:l++,e.next=38;break;case 49:return e.abrupt("return",{header:t,type:"avcC",configurationVersion:r,profileIndication:n,profileCompatibility:s,levelIndication:a,lengthSizeMinusOne:i,sequenceParameterSets:c,pictureParameterSets:x});case 50:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),z=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:n=e.sent,s=[],a=0;case 5:if(!(a<n)){e.next=14;break}return e.t0=s,e.next=9,this.stream.getNextUint32();case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:a++,e.next=5;break;case 14:return e.abrupt("return",{header:t,type:"stss",fullBoxHeader:r,sampleNumbers:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),M=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:n=e.sent,s=[],a=0;case 5:if(!(a<n)){e.next=14;break}return e.t0=s,e.next=9,this.stream.getNextUint32();case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:a++,e.next=5;break;case 14:return e.abrupt("return",{header:t,type:"stco",fullBoxHeader:r,chunkOffsets:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),R=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:n=e.sent,s=[],a=0;case 5:if(!(a<n)){e.next=21;break}return e.t0=s,e.next=9,this.stream.getNextUint32();case 9:return e.t1=e.sent,e.next=12,this.stream.getNextUint32();case 12:return e.t2=e.sent,e.next=15,this.stream.getNextUint32();case 15:e.t3=e.sent,e.t4={firstChunk:e.t1,samplesPerChunk:e.t2,sampleDescriptionIndex:e.t3},e.t0.push.call(e.t0,e.t4);case 18:a++,e.next=5;break;case 21:return e.abrupt("return",{header:t,type:"stsc",fullBoxHeader:r,entries:s});case 22:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),H=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:return e.t0=e.sent,n=[e.t0],e.next=6,this.stream.getNextUint32();case 6:if(s=e.sent,0!==n[0]){e.next=19;break}n=[],a=0;case 10:if(!(a<s)){e.next=19;break}return e.t1=n,e.next=14,this.stream.getNextUint32();case 14:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 16:a++,e.next=10;break;case 19:return e.abrupt("return",{header:t,type:"stsz",fullBoxHeader:r,sampleSizes:n,sampleCount:s});case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),_=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:n=e.sent,s=[],a=0;case 5:if(!(a<n)){e.next=18;break}return e.t0=s,e.next=9,this.stream.getNextUint32();case 9:return e.t1=e.sent,e.next=12,this.stream.getNextUint32();case 12:e.t2=e.sent,e.t3={sampleCount:e.t1,sampleDelta:e.t2},e.t0.push.call(e.t0,e.t3);case 15:a++,e.next=5;break;case 18:return e.abrupt("return",{header:t,type:"stts",fullBoxHeader:r,entries:s});case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),V=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChildBoxes();case 2:return e.abrupt("return",{header:t,type:"udta"});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),q=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:return e.next=4,this.stream.getNextString(4);case 4:n=e.sent,s=0;case 6:if(!(s<3)){e.next=12;break}return e.next=9,this.stream.getNextUint32();case 9:s++,e.next=6;break;case 12:return e.next=14,this.stream.getNextString();case 14:return a=e.sent,e.abrupt("return",{header:t,fullBoxHeader:r,type:"hdlr",handlerType:n,name:a});case 16:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),A=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint16();case 2:return n=e.sent,e.next=5,this.stream.getNextUint16();case 5:return e.t0=e.sent,e.next=8,this.stream.getNextUint16();case 8:return e.t1=e.sent,e.next=11,this.stream.getNextUint16();case 11:return e.t2=e.sent,s=[e.t0,e.t1,e.t2],e.abrupt("return",{header:t,fullBoxHeader:r,type:"vmhd",graphicsMode:n,opColor:s});case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),L=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.getNextUint32();case 2:n=e.sent,s=[],a=0;case 5:if(!(a<n)){e.next=14;break}return e.t0=s,e.next=9,this.getNextChildBox();case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:a++,e.next=5;break;case 14:return e.abrupt("return",{header:t,fullBoxHeader:r,type:"dref",entries:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),W=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChildBoxes();case 2:return r=e.sent,e.abrupt("return",{header:t,type:"dinf",dref:r.dref[0]});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),G=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",s="",1===r.flags){e.next=9;break}return e.next=5,this.stream.getNextString();case 5:return n=e.sent,e.next=8,this.stream.getNextString();case 8:s=e.sent;case 9:return e.abrupt("return",{header:t,fullBoxHeader:r,type:"urn ",name:n,location:s});case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),j=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",1===r.flags){e.next=5;break}return e.next=4,this.stream.getNextString();case 4:n=e.sent;case 5:return e.abrupt("return",{header:t,fullBoxHeader:r,type:"url ",location:n});case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Z),Q=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stream.seek(this.header.endOffset),e.abrupt("return",{header:t,type:"unknown"});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(g),J=r(1752),K=r(1120);function X(e,t){return Y.apply(this,arguments)}function Y(){return(Y=(0,s.Z)(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n={"url ":ie,"urn ":ue,avc1:ne,avcC:re,dinf:ce,dref:oe,ftyp:te,hdlr:fe,mdhd:ve,mdia:ge,minf:ke,moov:be,mvhd:we,stbl:ae,stco:pe,stsc:xe,stsd:se,stss:me,stsz:de,stts:le,tkhd:ye,trak:Ze,vmhd:he}[r.type])||console.warn("No writer available for %c".concat(r.type,", not writing."),"text-decoration: underline"),e.next=5,new n(t).write(r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=function(){function e(t){(0,i.Z)(this,e),this.stream=t}return(0,u.Z)(e,[{key:"write",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.stream.offset,e.next=3,this.stream.skip(4);case 3:return e.next=5,this.stream.writeNextString(t.type,4);case 5:return e.next=7,this.writeContents(t);case 7:return n=this.stream.offset,s=n-r,e.next=11,this.stream.seek(r);case 11:return e.next=13,this.stream.writeNextUint32(s);case 13:return e.next=15,this.stream.seek(n);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ee=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.writeNextUint8(t.fullBoxHeader.version);case 2:return e.next=4,this.stream.writeNextUint8(t.fullBoxHeader.flags>>16);case 4:return e.next=6,this.stream.writeNextUint8(t.fullBoxHeader.flags>>8);case 6:return e.next=8,this.stream.writeNextUint8(t.fullBoxHeader.flags);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}($),te=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.writeNextString(t.majorBrand,4);case 2:return e.next=4,this.stream.writeNextUint32(t.minorVersion);case 4:r=(0,p.Z)(t.compatibleBrands),e.prev=5,r.s();case 7:if((n=r.n()).done){e.next=13;break}return s=n.value,e.next=11,this.stream.writeNextString(s,4);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()}]),r}($),re=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s,a,i,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.writeNextUint8(t.configurationVersion);case 2:return e.next=4,this.stream.writeNextUint8(t.profileIndication);case 4:return e.next=6,this.stream.writeNextUint8(t.profileCompatibility);case 6:return e.next=8,this.stream.writeNextUint8(t.levelIndication);case 8:return e.next=10,this.stream.writeNextUint8(252|t.lengthSizeMinusOne);case 10:return e.next=12,this.stream.writeNextUint8(224|t.sequenceParameterSets.length);case 12:r=(0,p.Z)(t.sequenceParameterSets),e.prev=13,r.s();case 15:if((n=r.n()).done){e.next=23;break}return s=n.value,e.next=19,this.stream.writeNextUint16(s.byteLength);case 19:return e.next=21,this.stream.writeNextBytes(s);case 21:e.next=15;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(13),r.e(e.t0);case 28:return e.prev=28,r.f(),e.finish(28);case 31:return e.next=33,this.stream.writeNextUint8(t.pictureParameterSets.length);case 33:a=(0,p.Z)(t.pictureParameterSets),e.prev=34,a.s();case 36:if((i=a.n()).done){e.next=44;break}return u=i.value,e.next=40,this.stream.writeNextUint16(u.byteLength);case 40:return e.next=42,this.stream.writeNextBytes(u);case 42:e.next=36;break;case 44:e.next=49;break;case 46:e.prev=46,e.t1=e.catch(34),a.e(e.t1);case 49:return e.prev=49,a.f(),e.finish(49);case 52:case"end":return e.stop()}}),e,this,[[13,25,28,31],[34,46,49,52]])})));return function(t){return e.apply(this,arguments)}}()}]),r}($),ne=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stream.skip(6);case 2:return e.next=4,this.stream.writeNextUint16(t.dataReferenceIndex);case 4:return e.next=6,this.stream.skip(16);case 6:return e.next=8,this.stream.writeNextUint16(t.width);case 8:return e.next=10,this.stream.writeNextUint16(t.height);case 10:return e.next=12,this.stream.writeNextUint32(t.horizontalResolution);case 12:return e.next=14,this.stream.writeNextUint32(t.verticalResolution);case 14:return e.next=16,this.stream.skip(4);case 16:return e.next=18,this.stream.writeNextUint16(t.frameCount);case 18:return e.next=20,this.stream.writeNextString(t.compressorName,32);case 20:return e.next=22,this.stream.writeNextUint16(t.depth);case 22:return e.next=24,this.stream.writeNextUint16(65535);case 24:return e.next=26,X(this.stream,t.avcC);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}($),se=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.entries.length);case 4:n=(0,p.Z)(t.entries),e.prev=5,n.s();case 7:if((s=n.n()).done){e.next=13;break}return a=s.value,e.next=11,X(this.stream,a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),ae=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(this.stream,t.stco);case 2:return e.next=4,X(this.stream,t.stsc);case 4:return e.next=6,X(this.stream,t.stsd);case 6:return e.next=8,X(this.stream,t.stss);case 8:return e.next=10,X(this.stream,t.stsz);case 10:return e.next=12,X(this.stream,t.stts);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}($),ie=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextString(t.location);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),ue=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:if(1===t.fullBoxHeader.flags){e.next=7;break}return e.next=5,this.stream.writeNextString(t.name);case 5:return e.next=7,this.stream.writeNextString(t.location);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),ce=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(this.stream,t.dref);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}($),oe=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.entries.length);case 4:n=(0,p.Z)(t.entries),e.prev=5,n.s();case 7:if((s=n.n()).done){e.next=13;break}return a=s.value,e.next=11,X(this.stream,a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),he=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint16(t.graphicsMode);case 4:n=(0,p.Z)(t.opColor),e.prev=5,n.s();case 7:if((s=n.n()).done){e.next=13;break}return a=s.value,e.next=11,this.stream.writeNextUint16(a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),fe=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.skip(4);case 4:return e.next=6,this.stream.writeNextString(t.handlerType,4);case 6:return e.next=8,this.stream.skip(12);case 8:return e.next=10,this.stream.writeNextString(t.name);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),pe=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.chunkOffsets.length);case 4:n=(0,p.Z)(t.chunkOffsets),e.prev=5,n.s();case 7:if((s=n.n()).done){e.next=13;break}return a=s.value,e.next=11,this.stream.writeNextUint32(a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),de=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.sampleSizes.length>1?0:t.sampleSizes[0]);case 4:return e.next=6,this.stream.writeNextUint32(t.sampleCount);case 6:n=(0,p.Z)(t.sampleSizes),e.prev=7,n.s();case 9:if((s=n.n()).done){e.next=15;break}return a=s.value,e.next=13,this.stream.writeNextUint32(a);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[7,17,20,23]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),xe=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.entries.length);case 4:n=(0,p.Z)(t.entries),e.prev=5,n.s();case 7:if((s=n.n()).done){e.next=17;break}return a=s.value,e.next=11,this.stream.writeNextUint32(a.firstChunk);case 11:return e.next=13,this.stream.writeNextUint32(a.samplesPerChunk);case 13:return e.next=15,this.stream.writeNextUint32(a.sampleDescriptionIndex);case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),n.e(e.t0);case 22:return e.prev=22,n.f(),e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[5,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),le=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.entries.length);case 4:n=(0,p.Z)(t.entries),e.prev=5,n.s();case 7:if((s=n.n()).done){e.next=15;break}return a=s.value,e.next=11,this.stream.writeNextUint32(a.sampleCount);case 11:return e.next=13,this.stream.writeNextUint32(a.sampleDelta);case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[5,17,20,23]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),me=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.sampleNumbers.length);case 4:n=(0,p.Z)(t.sampleNumbers),e.prev=5,n.s();case 7:if((s=n.n()).done){e.next=13;break}return a=s.value,e.next=11,this.stream.writeNextUint32(a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),ve=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.creationTime);case 4:return e.next=6,this.stream.writeNextUint32(t.modificationTime);case 6:return e.next=8,this.stream.writeNextUint32(t.timescale);case 8:return e.next=10,this.stream.writeNextUint32(t.duration);case 10:return e.next=12,this.stream.skip(2);case 12:return e.next=14,this.stream.skip(2);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),ye=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.creationTime);case 4:return e.next=6,this.stream.writeNextUint32(t.modificationTime);case 6:return e.next=8,this.stream.writeNextUint32(t.trackId);case 8:return e.next=10,this.stream.skip(4);case 10:return e.next=12,this.stream.writeNextUint32(t.duration);case 12:return e.next=14,this.stream.skip(8);case 14:return e.next=16,this.stream.writeNextUint16(t.layer);case 16:return e.next=18,this.stream.writeNextUint16(t.alternateGroup);case 18:return e.next=20,this.stream.writeNextUint16(t.volume);case 20:return e.next=22,this.stream.skip(2);case 22:n=(0,p.Z)(t.matrix),e.prev=23,n.s();case 25:if((s=n.n()).done){e.next=31;break}return a=s.value,e.next=29,this.stream.writeNextUint32(a);case 29:e.next=25;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(23),n.e(e.t0);case 36:return e.prev=36,n.f(),e.finish(36);case 39:return e.next=41,this.stream.writeNextUint32(t.width);case 41:return e.next=43,this.stream.writeNextUint32(t.height);case 43:case"end":return e.stop()}}),e,this,[[23,33,36,39]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),we=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var n,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.Z)((0,K.Z)(r.prototype),"writeContents",this).call(this,t);case 2:return e.next=4,this.stream.writeNextUint32(t.creationTime);case 4:return e.next=6,this.stream.writeNextUint32(t.modificationTime);case 6:return e.next=8,this.stream.writeNextUint32(t.timescale);case 8:return e.next=10,this.stream.writeNextUint32(t.duration);case 10:return e.next=12,this.stream.writeNextUint32(t.rate);case 12:return e.next=14,this.stream.writeNextUint16(t.volume);case 14:return e.next=16,this.stream.skip(10);case 16:n=(0,p.Z)(t.matrix),e.prev=17,n.s();case 19:if((s=n.n()).done){e.next=25;break}return a=s.value,e.next=23,this.stream.writeNextUint32(a);case 23:e.next=19;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(17),n.e(e.t0);case 30:return e.prev=30,n.f(),e.finish(30);case 33:return e.next=35,this.stream.skip(24);case 35:return e.next=37,this.stream.writeNextUint32(t.nextTrackId);case 37:case"end":return e.stop()}}),e,this,[[17,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(ee),ke=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(this.stream,t.vmhd);case 2:return e.next=4,X(this.stream,t.dinf);case 4:return e.next=6,X(this.stream,t.stbl);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}($),ge=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(this.stream,t.mdhd);case 2:return e.next=4,X(this.stream,t.hdlr);case 4:return e.next=6,X(this.stream,t.minf);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}($),Ze=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(this.stream,t.tkhd);case 2:return e.next=4,X(this.stream,t.mdia);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}($),be=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(this.stream,t.mvhd);case 2:r=(0,p.Z)(t.trak),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=11;break}return s=n.value,e.next=9,X(this.stream,s);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}()}]),r}($),Ne=function(){function e(t){(0,i.Z)(this,e),this.stream=t,this.startOffset=0,this.opened=!1,this.closed=!1}return(0,u.Z)(e,[{key:"open",value:function(){var e=(0,s.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.opened){e.next=4;break}throw new Error("already opened");case 4:if(!this.closed){e.next=6;break}throw new Error("already closed");case 6:return this.startOffset=this.stream.offset,e.next=9,this.stream.skip(4);case 9:return e.next=11,this.stream.writeNextString("mdat",4);case 11:this.opened=!0;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=(0,s.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.opened){e.next=4;break}throw new Error("not opened");case 4:if(!this.closed){e.next=6;break}throw new Error("already closed");case 6:return e.next=8,this.stream.writeNextBytes(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.opened){e.next=4;break}throw new Error("not opened");case 4:if(!this.closed){e.next=6;break}throw new Error("already closed");case 6:return t=this.stream.offset,e.next=9,this.stream.seek(this.startOffset);case 9:return e.next=11,this.stream.writeNextUint32(t-this.startOffset);case 11:return e.next=13,this.stream.seek(t);case 13:this.closed=!0;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataStartOffset",get:function(){if(!this.opened)throw new Error("not opened");return this.startOffset+8}}]),e}(),Ue=function(){function e(t){(0,i.Z)(this,e),this.stream=void 0,this.mdat=void 0,this.moov=void 0,this.stream=new x(t)}return(0,u.Z)(e,[{key:"parse",value:function(){var e=(0,s.Z)(o().mark((function e(){var t,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parseBox();case 2:if("ftyp"===e.sent.type){e.next=5;break}throw new Error("Expected ftyp box at start of file. Not an MP4?");case 5:if(this.stream.eof){e.next=19;break}return e.next=8,this.parseBox();case 8:n=e.sent,e.t0=n.type,e.next="mdat"===e.t0?12:"moov"===e.t0?14:16;break;case 12:return t=n,e.abrupt("break",17);case 14:return r=n,e.abrupt("break",17);case 16:return e.abrupt("break",17);case 17:e.next=5;break;case 19:if(t&&r){e.next=21;break}throw new Error("Missing mdat or moov box");case 21:this.mdat=t,this.moov=r;case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSample",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r,n,s,a,i,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this.moov.trak[0].mdia.minf.stbl,n=r.stsz,s=r.stco,a=n.sampleSizes[t],i=s.chunkOffsets[0],u=i,c=0;c<t;c++)u+=r.stsz.sampleSizes[c];return this.stream.seek(u),e.next=10,this.stream.getNextBytes(a);case 10:return e.t0=e.sent,e.t1=this.isSampleSync(t),e.abrupt("return",{data:e.t0,sync:e.t1});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isSampleSync",value:function(e){return this.moov.trak[0].mdia.minf.stbl.stss.sampleNumbers.includes(e+1)}},{key:"parseBox",value:function(){var e=(0,s.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(this.stream);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Be=function(){function e(t){(0,i.Z)(this,e),this.stream=void 0,this.mdat=void 0,this.avcC=void 0,this.sampleCount=0,this.syncSamples=[],this.sampleSizes=[],this.displaySize=void 0,this.stream=new l(t),this.mdat=new Ne(this.stream)}return(0,u.Z)(e,[{key:"open",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={type:"ftyp",majorBrand:"isom",minorVersion:0,compatibleBrands:["mp41","avc1","isom"]},e.next=3,X(this.stream,t);case 3:return e.next=5,this.mdat.open();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"writeSample",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mdat.write(t);case 2:r&&this.syncSamples.push(this.sampleCount+1),this.sampleSizes.push(t instanceof Blob?t.size:t.byteLength),this.sampleCount++;case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setAvcC",value:function(e){var t,r={type:"avcC",configurationVersion:(t=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength)).getUint8(0),profileIndication:t.getUint8(1),profileCompatibility:t.getUint8(2),levelIndication:t.getUint8(3),lengthSizeMinusOne:3&t.getUint8(4),sequenceParameterSets:[],pictureParameterSets:[]},n=5,s=31&t.getUint8(n);n+=1;for(var a=[],i=0;i<s;i++){var u=t.getUint16(n);n+=2;var c=new Uint8Array(t.buffer,t.byteOffset+n,u);a.push(c),n+=u}var o=t.getUint8(n);n+=1;for(var h=[],f=0;f<o;f++){var p=t.getUint16(n);n+=2;var d=new Uint8Array(t.buffer,t.byteOffset+n,p);h.push(d),n+=p}r.sequenceParameterSets=a,r.pictureParameterSets=h,this.avcC=r}},{key:"setDisplaySize",value:function(e){this.displaySize={width:e.width,height:e.height}}},{key:"close",value:function(){var e=(0,s.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mdat.close();case 2:return t={type:"moov",mvhd:this.getMvhdBox(),trak:[this.getTrakBox()]},e.next=5,X(this.stream,t);case 5:return e.next=7,this.stream.close();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTrakBox",value:function(){return{type:"trak",tkhd:this.getTkhdBox(),mdia:this.getMdiaBox()}}},{key:"getTkhdBox",value:function(){var e=new Date("1904-01-01T00:00:00Z"),t=new Date,r=Math.floor((t.getTime()-e.getTime())/1e3);return{type:"tkhd",fullBoxHeader:{version:0,flags:3},alternateGroup:0,creationTime:r,duration:60*this.sampleCount,width:this.displaySize.width,height:this.displaySize.height,layer:0,matrix:[65536,0,0,0,65536,0,0,0,1073741824],modificationTime:r,trackId:1,volume:0}}},{key:"getMvhdBox",value:function(){var e=new Date("1904-01-01T00:00:00Z"),t=new Date,r=Math.floor((t.getTime()-e.getTime())/1e3);return{type:"mvhd",fullBoxHeader:{version:0,flags:0},duration:Math.floor(1e3*this.sampleCount/60),creationTime:r,modificationTime:r,timescale:1e3,rate:65536,volume:256,matrix:[65536,0,0,0,65536,0,0,0,1073741824],nextTrackId:2}}},{key:"getMdiaBox",value:function(){return{type:"mdia",hdlr:{type:"hdlr",fullBoxHeader:{version:0,flags:0},handlerType:"vide",name:"VideoHandler"},minf:this.getMinfBox(),mdhd:this.getMdhdBox()}}},{key:"getMdhdBox",value:function(){var e=new Date("1904-01-01T00:00:00Z"),t=new Date,r=Math.floor((t.getTime()-e.getTime())/1e3);return{type:"mdhd",fullBoxHeader:{version:0,flags:0},creationTime:r,duration:this.sampleCount,language:"",modificationTime:r,timescale:60}}},{key:"getMinfBox",value:function(){var e=this.getStblBox();return{type:"minf",dinf:this.getDinfBox(),stbl:e,vmhd:{type:"vmhd",fullBoxHeader:{version:0,flags:1},graphicsMode:0,opColor:[0,0,0]}}}},{key:"getDinfBox",value:function(){return{type:"dinf",dref:{type:"dref",fullBoxHeader:{version:0,flags:0},entries:[{type:"url ",fullBoxHeader:{version:0,flags:1},location:""}]}}}},{key:"getStblBox",value:function(){return{type:"stbl",stco:{type:"stco",fullBoxHeader:{version:0,flags:0},chunkOffsets:[this.mdat.dataStartOffset]},stsc:{type:"stsc",fullBoxHeader:{version:0,flags:0},entries:[{firstChunk:1,samplesPerChunk:this.sampleCount,sampleDescriptionIndex:1}]},stsd:{type:"stsd",fullBoxHeader:{version:0,flags:0},entries:[{type:"avc1",dataReferenceIndex:1,width:this.displaySize.width,height:this.displaySize.height,horizontalResolution:4718592,verticalResolution:4718592,frameCount:1,compressorName:"mp4.ts",depth:24,avcC:this.avcC}]},stss:{type:"stss",fullBoxHeader:{version:0,flags:0},sampleNumbers:this.syncSamples},stsz:{type:"stsz",fullBoxHeader:{version:0,flags:0},sampleCount:this.sampleCount,sampleSizes:this.sampleSizes},stts:{type:"stts",fullBoxHeader:{version:0,flags:0},entries:[{sampleCount:this.sampleCount,sampleDelta:1}]}}}}]),e}();function Se(e){var t=new d.StreamDataView(void 0,!0);t.setNextUint8(e.configurationVersion),t.setNextUint8(e.profileIndication),t.setNextUint8(e.profileCompatibility),t.setNextUint8(e.levelIndication),t.setNextUint8(e.lengthSizeMinusOne+252),t.setNextUint8(e.sequenceParameterSets.length+224);for(var r=0;r<e.sequenceParameterSets.length;r++){t.setNextUint16(e.sequenceParameterSets[r].length);for(var n=0;n<e.sequenceParameterSets[r].length;n++)t.setNextUint8(e.sequenceParameterSets[r][n])}t.setNextUint8(e.pictureParameterSets.length);for(var s=0;s<e.pictureParameterSets.length;s++){t.setNextUint16(e.pictureParameterSets[s].length);for(var a=0;a<e.pictureParameterSets[s].length;a++)t.setNextUint8(e.pictureParameterSets[s][a])}return t.getBuffer()}var Ce=function(){function e(t){(0,i.Z)(this,e),this.decoder=void 0,this.encoder=void 0,this.inMp4=void 0,this.outMp4=void 0,this.expectedFrames=0,this.framesDecoded=0,this.framesEncoded=0,this.queuedForDecode=0,this.queuedForEncode=0,this.infoReady=void 0,this.modifyFrame=void 0,this.progressInit=void 0,this.progressUpdate=void 0,this.samplePromise=Promise.resolve(),this.decoderPromise=Promise.resolve(),this.encoderPromise=Promise.resolve(),this.infoReady=t.infoReady,this.modifyFrame=t.modifyFrame,this.progressInit=t.progressInit,this.progressUpdate=t.progressUpdate}return(0,u.Z)(e,[{key:"reset",value:function(){this.encoder&&this.encoder.close(),this.encoder=new VideoEncoder({output:this.handleEncodedFrame.bind(this),error:this.handleEncoderError.bind(this)}),this.decoder&&this.decoder.close(),this.decoder=new VideoDecoder({output:this.handleDecodedFrame.bind(this),error:this.handleDecoderError.bind(this)}),this.samplePromise=Promise.resolve(),this.decoderPromise=Promise.resolve(),this.encoderPromise=Promise.resolve()}},{key:"processFile",value:function(){var e=(0,s.Z)(o().mark((function e(t,r){var n,s,a,i,u,c,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.reset(),this.inMp4=new Ue(t),e.next=4,this.inMp4.parse();case 4:n=(0,p.Z)(this.inMp4.moov.trak[0].mdia.minf.stbl.stsz.sampleSizes.entries());try{for(n.s();!(s=n.n()).done;)a=(0,f.Z)(s.value,2),i=a[0],(u=a[1])<=100&&console.warn("Frame ".concat(i," is too small (").concat(u," bytes)!"))}catch(o){n.e(o)}finally{n.f()}return this.outMp4=new Be(r),e.next=9,this.outMp4.open();case 9:c=this.inMp4.moov.trak[0].mdia.minf.stbl.stsd.entries[0],h="avc1."+c.avcC.profileIndication.toString(16).padStart(2,"0")+c.avcC.profileCompatibility.toString(16).padStart(2,"0")+c.avcC.levelIndication.toString(16).padStart(2,"0"),this.decoder.configure({codec:h,codedWidth:this.inMp4.moov.trak[0].tkhd.width,codedHeight:this.inMp4.moov.trak[0].tkhd.height,description:Se(this.inMp4.moov.trak[0].mdia.minf.stbl.stsd.entries[0].avcC),optimizeForLatency:!1}),this.infoReady(this.inMp4.moov.trak[0].tkhd.width,this.inMp4.moov.trak[0].tkhd.height);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"processSamples",value:function(e){var t;this.encoder.configure({codec:"avc1.42003d",width:e.width,height:e.height,bitrate:5e7,framerate:60,latencyMode:"quality"}),null===(t=this.outMp4)||void 0===t||t.setDisplaySize({width:e.width,height:e.height}),this.framesDecoded=0,this.framesEncoded=0,this.queuedForDecode=0,this.queuedForEncode=0,this.expectedFrames=this.inMp4.moov.trak[0].mdia.mdhd.duration,this.progressInit(this.expectedFrames),this.decodeNextSamples()}},{key:"decodeNextSamples",value:function(){var e=this;this.samplePromise=this.samplePromise.then((0,s.Z)(o().mark((function t(){var r,n,s,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=e.expectedFrames-e.queuedForDecode)<=0)){t.next=6;break}return console.debug("No more samples to decode"),t.abrupt("return");case 6:console.debug("Remaining samples: ".concat(n));case 7:if(console.debug("Dec queue: ".concat(e.decoder.decodeQueueSize,", Enc queue: ").concat(e.encoder.encodeQueueSize)),!((e.decoder.decodeQueueSize>60||e.encoder.encodeQueueSize>60)&&n>60)){t.next=11;break}return console.debug("Queues too full, not adding more samples"),t.abrupt("return");case 11:return t.next=13,e.inMp4.getSample(e.queuedForDecode);case 13:if(!((s=t.sent).data.byteLength<=100)){t.next=22;break}return console.warn("Skipping tiny frame ".concat(e.queuedForDecode)),e.queuedForDecode++,e.framesDecoded++,e.queuedForEncode++,e.framesEncoded++,e.decodeNextSamples(),t.abrupt("return");case 22:a=new EncodedVideoChunk({type:s.sync?"key":"delta",timestamp:0,duration:60,data:s.data.buffer}),e.decoder.decode(a),e.queuedForDecode++,n--,null!==(r=e.inMp4)&&void 0!==r&&r.isSampleSync(e.queuedForDecode)&&e.decoder.flush(),e.decodeNextSamples();case 28:case"end":return t.stop()}}),t)}))))}},{key:"handleDecodedFrame",value:function(e){var t=this;this.decoderPromise=this.decoderPromise.then((0,s.Z)(o().mark((function r(){var n;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.framesDecoded%15===0&&(console.debug("Flushing encoder at decoded frame ".concat(t.framesDecoded,", keyframe incoming.")),t.encoder.flush()),n=t.modifyFrame(e,t.framesDecoded),e.close(),t.encoder.encode(n,{keyFrame:t.framesDecoded%15===0}),t.queuedForEncode++,t.framesDecoded%15===0&&createImageBitmap(n).then((function(e){t.progressUpdate(void 0,e)})),n.close(),t.framesDecoded++,t.framesDecoded===t.expectedFrames-1&&(console.debug("Flushing encoder at decoded frame ".concat(t.framesDecoded,", last frame.")),t.encoder.flush());case 9:case"end":return r.stop()}}),r)}))))}},{key:"handleEncodedFrame",value:function(e,t){var r=this;this.encoderPromise=this.encoderPromise.then((0,s.Z)(o().mark((function n(){var s,a,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return 0===r.framesEncoded&&r.outMp4.setAvcC(null===(s=t.decoderConfig)||void 0===s?void 0:s.description),r.framesEncoded++,console.debug("Encoded frame ".concat(r.framesEncoded)),a=new ArrayBuffer(e.byteLength),e.copyTo(a),n.next=7,r.outMp4.writeSample(a,"key"===e.type);case 7:if(r.progressUpdate(r.framesEncoded),r.framesEncoded!==r.expectedFrames){n.next=14;break}return n.next=11,null===(i=r.outMp4)||void 0===i?void 0:i.close();case 11:postMessage({type:h.MessageType.FILE_OUT}),n.next=15;break;case 14:r.decodeNextSamples();case 15:case"end":return n.stop()}}),n)}))))}},{key:"handleDecoderError",value:function(e){throw console.log(this.expectedFrames,this.framesDecoded),e}},{key:"handleEncoderError",value:function(e){throw e}}]),e}(),Ee=256,Oe=function(){function e(t,r){(0,i.Z)(this,e),this.name=void 0,this.tiles=void 0,this.name=t,this.tiles=r}return(0,u.Z)(e,[{key:"getTile",value:function(e){return this.tiles[e]}}],[{key:"fromFile",value:function(){var t=(0,s.Z)(o().mark((function t(r){var n,s,a,i,u,c,h,f,p;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.arrayBuffer();case 2:n=t.sent,s=r.name.includes("hd"),a=s?24:36,i=s?36:54,u=[],c=0;case 8:if(!(c<Ee)){t.next=18;break}return h=new Uint8ClampedArray(n,c*a*i*4,a*i*4),f=new ImageData(h,a,i),t.next=13,createImageBitmap(f);case 13:p=t.sent,u.push(p);case 15:c++,t.next=8;break;case 18:return t.abrupt("return",new e(r.name,u));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"fromFiles",value:function(){var t=(0,s.Z)(o().mark((function t(r){var n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.map((function(t){return e.fromFile(t)})),t.next=3,Promise.all(n);case 3:return s=t.sent,t.abrupt("return",{sd1:s.find((function(e){return!e.name.includes("_2")&&!e.name.includes("hd")})),sd2:s.find((function(e){return e.name.includes("_2")&&!e.name.includes("hd")})),hd1:s.find((function(e){return!e.name.includes("_2")&&e.name.includes("hd")})),hd2:s.find((function(e){return e.name.includes("_2")&&e.name.includes("hd")}))});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),Fe=function(){function e(t){(0,i.Z)(this,e),this.header=void 0,this.frames=[];var r=new d.StreamDataView(t);for(this.header={magic:r.getNextString(7),version:r.getNextUint16(),config:{charWidth:r.getNextUint8(),charHeight:r.getNextUint8(),fontWidth:r.getNextUint8(),fontHeight:r.getNextUint8(),xOffset:r.getNextUint16(),yOffset:r.getNextUint16(),fontVariant:r.getNextUint8()}},31===this.header.config.charWidth&&(this.header.config.charWidth=30);r.getOffset()<t.byteLength;)try{var n=r.getNextUint32(),s=r.getNextUint32(),a=new Uint16Array(t,r.getOffset(),s);r.setOffset(r.getOffset()+2*s),this.frames.push({frameNumber:n,frameSize:s,frameData:a})}catch(u){if(u instanceof RangeError){console.warn("No more data in OSD file, probably truncated due to power loss");break}}}return(0,u.Z)(e,null,[{key:"fromFile",value:function(){var t=(0,s.Z)(o().mark((function t(r){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.arrayBuffer();case 2:return n=t.sent,t.abrupt("return",new e(n));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),De=function(){function e(){(0,i.Z)(this,e),this.processor=void 0,this.fontPack=void 0,this.osdReader=void 0,this.lastOsdIndex=0,this.wide=!1,this.hd=!1,this.outWidth=void 0,this.outHeight=void 0,this.osdCanvas=void 0,this.osdCtx=void 0,this.frameCanvas=void 0,this.frameCtx=void 0,this.processor=new Ce({infoReady:this.infoReady.bind(this),modifyFrame:this.modifyFrame.bind(this),progressInit:this.progressInit.bind(this),progressUpdate:this.progressUpdate.bind(this)}),addEventListener("message",this.onMessage.bind(this))}return(0,u.Z)(e,[{key:"infoReady",value:function(e,t){var r,n;1280===e&&720===t&&(this.wide=!0),24===this.osdReader.header.config.fontWidth&&(this.hd=!0),this.wide||this.hd?(r=1280,n=720):(r=e,n=t),this.outWidth=r,this.outHeight=n,this.osdCanvas=new OffscreenCanvas(this.osdReader.header.config.fontWidth*this.osdReader.header.config.charWidth,this.osdReader.header.config.fontHeight*this.osdReader.header.config.charHeight),this.osdCtx=this.osdCanvas.getContext("2d"),this.frameCanvas=new OffscreenCanvas(this.outWidth,this.outHeight),this.frameCtx=this.frameCanvas.getContext("2d"),this.processor.processSamples({width:r,height:n})}},{key:"modifyFrame",value:function(e,t){var r,n=this.osdCanvas,s=this.osdCtx,a=this.frameCanvas,i=this.frameCtx;if(i.fillStyle="black",i.fillRect(0,0,a.width,a.height),s.clearRect(0,0,n.width,n.height),r=this.hd||this.wide?(this.outWidth-e.displayWidth)/2:0,i.drawImage(e,r,0),this.lastOsdIndex<this.osdReader.frames.length-1){var u=this.lastOsdIndex+1;t>=this.osdReader.frames[u].frameNumber&&(this.lastOsdIndex=u)}for(var c,o=this.osdReader.frames[this.lastOsdIndex],h=0;h<22;h++)for(var f=0;f<60;f++){var p=h+22*f,d=o.frameData[p],x=void 0;x=this.hd?d<Ee?this.fontPack.hd1:this.fontPack.hd2:d<Ee?this.fontPack.sd1:this.fontPack.sd2,s.drawImage(x.getTile(d%Ee),f*this.osdReader.header.config.fontWidth,h*this.osdReader.header.config.fontHeight)}c=a.height/n.height<a.width/n.width?a.height/n.height:a.width/n.width;var l=n.width*c,m=n.height*c,v=(a.width-l)/2,y=(a.height-m)/2;return i.drawImage(n,v,y,l,m),new VideoFrame(a,{timestamp:e.timestamp})}},{key:"progressInit",value:function(e){postMessage({type:h.MessageType.PROGRESS_INIT,expectedFrames:e})}},{key:"progressUpdate",value:function(e,t){postMessage({type:h.MessageType.PROGRESS_UPDATE,currentFrame:e,preview:t},(0,a.Z)(t?[t]:[]))}},{key:"onMessage",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.data,e.t0=r.type,e.next=e.t0===h.MessageType.FILE_IN?4:17;break;case 4:return console.debug("Hello from the worker!"),e.next=7,Fe.fromFile(r.osdFile);case 7:return this.osdReader=e.sent,console.debug("Got OSD reader"),e.next=11,Oe.fromFiles(r.fontFiles);case 11:return this.fontPack=e.sent,console.debug("Got font pack"),console.debug("Starting processor..."),e.next=16,this.processor.processFile(r.videoFile,r.outHandle);case 16:return e.abrupt("break",18);case 17:throw new Error("Unknown message type received");case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();new De}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,r.x=function(){var e=r.O(void 0,[923],(function(){return r(451)}));return e=r.O(e)},function(){var e=[];r.O=function(t,n,s,a){if(!n){var i=1/0;for(h=0;h<e.length;h++){n=e[h][0],s=e[h][1],a=e[h][2];for(var u=!0,c=0;c<n.length;c++)(!1&a||i>=a)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(u=!1,a<i&&(i=a));if(u){e.splice(h--,1);var o=s();void 0!==o&&(t=o)}}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[n,s,a]}}(),r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,n){return r.f[n](e,t),t}),[]))},r.u=function(e){return"static/js/"+e+".c2012502.chunk.js"},r.miniCssF=function(e){},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",function(){var e={451:1};r.f.i=function(t,n){e[t]||importScripts(r.p+r.u(t))};var t=self.webpackChunkwtfos_configurator=self.webpackChunkwtfos_configurator||[],n=t.push.bind(t);t.push=function(t){var s=t[0],a=t[1],i=t[2];for(var u in a)r.o(a,u)&&(r.m[u]=a[u]);for(i&&i(r);s.length;)e[s.pop()]=1;n(t)}}(),function(){var e=r.x;r.x=function(){return r.e(923).then(e)}}();r.x()}();
//# sourceMappingURL=451.5ed04061.chunk.js.map