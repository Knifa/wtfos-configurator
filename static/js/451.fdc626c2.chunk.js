!function(){"use strict";var t={451:function(t,e,r){var n,s=r(5861),i=r(3433),a=r(5671),u=r(3144),c=r(7757),o=r.n(c);!function(t){var e;!function(t){t[t.FILE_IN=0]="FILE_IN",t[t.FILE_OUT=1]="FILE_OUT",t[t.PROGRESS_INIT=2]="PROGRESS_INIT",t[t.PROGRESS_UPDATE=3]="PROGRESS_UPDATE"}(e||(e={})),t.MessageType=e}(n||(n={}));var h=n,f=r(7449),p=function(){function t(e){(0,a.Z)(this,t),this.file=void 0,this.buffer=new ArrayBuffer(0),this.bufferOffset=0,this._offset=0,this.file=e}return(0,u.Z)(t,[{key:"getNextString",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s,i,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,this.getNextBytes(e);case 3:r=t.sent,t.next=15;break;case 6:n=[];case 7:return t.next=9,this.getNextUint8();case 9:if(t.t0=s=t.sent,0===t.t0){t.next=14;break}n.push(s),t.next=7;break;case 14:r=new Uint8Array(n);case 15:return i=new TextDecoder,a=i.decode(r),t.abrupt("return",a);case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getNextUint8",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(1);case 2:return e=t.sent,t.abrupt("return",e.getUint8(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextUint16",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(2);case 2:return e=t.sent,t.abrupt("return",e.getUint16(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextUint32",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(4);case 2:return e=t.sent,t.abrupt("return",e.getUint32(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextUint64",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(8);case 2:return e=t.sent,t.abrupt("return",e.getBigUint64(0));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextBytes",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDataView(e);case 2:for(r=t.sent,n=new Uint8Array(e),s=0;s<e;s++)n[s]=r.getUint8(s);return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"seek",value:function(t){this._offset=t,(this._offset<this.bufferOffset||this._offset>this.bufferEndOffset)&&(this.buffer=new ArrayBuffer(0),this.bufferOffset=this._offset)}},{key:"skip",value:function(t){this._offset+=t}},{key:"offset",get:function(){return this._offset}},{key:"eof",get:function(){return this.offset>=this.file.size}},{key:"fillBuffer",value:function(){var e=(0,s.Z)(o().mark((function e(r){var n,s,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this.offset+r)>this.bufferEndOffset)){e.next=8;break}return s=Math.floor(this.offset/t.BUFFER_SIZE)*t.BUFFER_SIZE,i=Math.ceil(n/t.BUFFER_SIZE)*t.BUFFER_SIZE,e.next=6,this.file.slice(s,i).arrayBuffer();case 6:this.buffer=e.sent,this.bufferOffset=s;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDataView",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fillBuffer(e);case 2:return r=new DataView(this.buffer,this.offset-this.bufferOffset,e),this._offset+=e,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"bufferEndOffset",get:function(){return this.bufferOffset+this.buffer.byteLength}}]),t}();p.BUFFER_SIZE=8388608;var x=function(){function t(e){(0,a.Z)(this,t),this.file=void 0,this.stream=void 0,this._offset=0,this._size=0,this.file=e}return(0,u.Z)(t,[{key:"writeNextUint8",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new Uint8Array(1))[0]=e,t.next=4,this.writeNextBytes(r);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"writeNextUint16",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ArrayBuffer(2),new DataView(r).setUint16(0,e,!1),t.next=5,this.writeNextBytes(r);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"writeNextUint32",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ArrayBuffer(4),new DataView(r).setUint32(0,e,!1),t.next=5,this.writeNextBytes(r);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"writeNextString",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Uint8Array(void 0!==r?r:e.length+1),(new TextEncoder).encodeInto(e,n),t.next=5,this.writeNextBytes(n);case 5:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"writeNextBytes",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStream();case 2:return r=t.sent,t.next=5,r.write(e);case 5:n=e instanceof Blob?e.size:e.byteLength,this._offset+=n,this._size+=n;case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"skip",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.seek(this.offset+e);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"seek",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStream();case 2:return r=t.sent,t.next=5,r.seek(e);case 5:this._offset=e;case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStream();case 2:return e=t.sent,t.next=5,e.close();case 5:this.stream=void 0;case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getStream",value:function(){var t=(0,s.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.stream){t.next=8;break}return t.next=3,this.file.createWritable();case 3:return this.stream=t.sent,t.next=6,this.stream.truncate(0);case 6:this._size=0,this._offset=0;case 8:return t.abrupt("return",this.stream);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"offset",get:function(){return this._offset}},{key:"size",get:function(){return this._size}}]),t}(),d=r(136),l=r(9388);function m(t){return v.apply(this,arguments)}function v(){return(v=(0,s.Z)(o().mark((function t(e){var r,n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getNextUint32();case 2:return r=t.sent,t.next=5,e.getNextString(4);case 5:return n=t.sent,(s={"url ":W,"urn ":L,avc1:D,avcC:I,dinf:A,dref:q,ftyp:g,hdlr:_,mdat:Z,mdhd:S,mdia:C,minf:O,moov:b,mvhd:N,stbl:E,stco:M,stsc:z,stsd:F,stss:T,stsz:H,stts:R,tkhd:B,trak:U,udta:P,vmhd:V})[n]?i=new s[n](e,r,n):(console.warn("No parser available for %c".concat(n),"text-decoration: underline"),i=new G(e,r,n)),t.next=10,i.parse();case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var y=function(){function t(e,r,n){(0,a.Z)(this,t),this.stream=void 0,this.size=void 0,this.type=void 0,this.header=void 0,this.stream=e,this.size=r,this.type=n,this.header=this.getHeader()}return(0,u.Z)(t,[{key:"getHeader",value:function(){var t=this.stream.offset-8,e=t+this.size;return{size:this.size,type:this.type,startOffset:t,endOffset:e}}},{key:"getChildBoxes",value:function(){var t=(0,s.Z)(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e={};case 1:if(!(this.stream.offset<this.header.endOffset)){t.next=10;break}return t.next=4,this.getNextChildBox();case 4:"unknown"===(r=t.sent).type&&console.warn("Child box %c".concat(r.header.type,"%c in %c").concat(this.type,"%c is unknown, ignoring."),"text-decoration: underline","text-decoration: none","text-decoration: underline","text-decoration: none"),r.type in e||(e[r.type]=[]),e[r.type].push(r),t.next=1;break;case 10:return t.abrupt("return",e);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNextChildBox",value:function(){var t=(0,s.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(this.stream);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"seekToEnd",value:function(){if(this.stream.offset!==this.header.endOffset){var t=this.header.endOffset-this.stream.offset;console.warn("Box %c".concat(this.header.type,"%c was not fully parsed! Stopped ").concat(t,"B early."),"text-decoration: underline","text-decoration: none",this.header)}this.stream.seek(this.header.endOffset)}}]),t}(),w=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parse",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.parseBox(this.header);case 2:return e=t.sent,this.seekToEnd(),t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),r}(y),k=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"getFullBoxHeader",value:function(){var t=(0,s.Z)(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint8();case 2:return e=t.sent,t.next=5,this.stream.getNextUint8();case 5:return t.t0=t.sent,t.t1=t.t0<<16,t.next=9,this.stream.getNextUint8();case 9:return t.t2=t.sent,t.t3=t.t2<<8,t.t4=t.t1|t.t3,t.next=14,this.stream.getNextUint8();case 14:return t.t5=t.sent,r=t.t4|t.t5,t.abrupt("return",{version:e,flags:r});case 17:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"parse",value:function(){var t=(0,s.Z)(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFullBoxHeader();case 2:return e=t.sent,t.next=5,this.parseBox(this.header,e);case 5:return r=t.sent,this.seekToEnd(),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),r}(y),g=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextString(4);case 2:return r=t.sent,t.next=5,this.stream.getNextUint32();case 5:n=t.sent,s=[],i=0;case 8:if(!(i<(this.size-16)/4)){t.next=17;break}return t.t0=s,t.next=12,this.stream.getNextString(4);case 12:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 14:i++,t.next=8;break;case 17:return t.abrupt("return",{type:"ftyp",header:e,majorBrand:r,minorVersion:n,compatibleBrands:s});case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),Z=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.stream.seek(this.header.endOffset),t.abrupt("return",{type:"mdat",header:e});case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),b=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{type:"moov",header:e,mvhd:r.mvhd[0],trak:r.trak});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),N=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i,a,u,c,h,f,p,x;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==r.version){t.next=2;break}throw new Error("Version 1 not supported");case 2:return t.next=4,this.stream.getNextUint32();case 4:return n=t.sent,t.next=7,this.stream.getNextUint32();case 7:return s=t.sent,t.next=10,this.stream.getNextUint32();case 10:return i=t.sent,t.next=13,this.stream.getNextUint32();case 13:return a=t.sent,t.next=16,this.stream.getNextUint32();case 16:return u=t.sent,t.next=19,this.stream.getNextUint16();case 19:return c=t.sent,t.next=22,this.stream.getNextUint16();case 22:return t.next=24,this.stream.getNextUint32();case 24:return t.next=26,this.stream.getNextUint32();case 26:h=[],f=0;case 28:if(!(f<9)){t.next=37;break}return t.t0=h,t.next=32,this.stream.getNextUint32();case 32:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 34:f++,t.next=28;break;case 37:p=0;case 38:if(!(p<6)){t.next=44;break}return t.next=41,this.stream.getNextUint32();case 41:p++,t.next=38;break;case 44:return t.next=46,this.stream.getNextUint32();case 46:return x=t.sent,t.abrupt("return",{header:e,type:"mvhd",fullBoxHeader:r,creationTime:n,modificationTime:s,timescale:i,duration:a,rate:u,volume:c,matrix:h,nextTrackId:x});case 48:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),U=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"trak",tkhd:r.tkhd[0],mdia:r.mdia[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),B=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i,a,u,c,h,f,p,x,d;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==r.version){t.next=2;break}throw new Error("Version 1 not supported");case 2:return t.next=4,this.stream.getNextUint32();case 4:return n=t.sent,t.next=7,this.stream.getNextUint32();case 7:return s=t.sent,t.next=10,this.stream.getNextUint32();case 10:return i=t.sent,t.next=13,this.stream.getNextUint32();case 13:return t.next=15,this.stream.getNextUint32();case 15:return a=t.sent,t.next=18,this.stream.getNextUint32();case 18:return t.next=20,this.stream.getNextUint32();case 20:return t.next=22,this.stream.getNextUint16();case 22:return u=t.sent,t.next=25,this.stream.getNextUint16();case 25:return c=t.sent,t.next=28,this.stream.getNextUint16();case 28:return h=t.sent,t.next=31,this.stream.getNextUint16();case 31:f=[],p=0;case 33:if(!(p<9)){t.next=42;break}return t.t0=f,t.next=37,this.stream.getNextUint32();case 37:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 39:p++,t.next=33;break;case 42:return t.next=44,this.stream.getNextUint32();case 44:return t.t2=t.sent,x=t.t2>>16,t.next=48,this.stream.getNextUint32();case 48:return t.t3=t.sent,d=t.t3>>16,t.abrupt("return",{header:e,type:"tkhd",fullBoxHeader:r,creationTime:n,modificationTime:s,trackId:i,duration:a,layer:u,alternateGroup:c,volume:h,matrix:f,width:x,height:d});case 51:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),C=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"mdia",mdhd:r.mdhd[0],minf:r.minf[0],hdlr:r.hdlr[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),S=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i,a,u;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==r.version){t.next=2;break}throw new Error("Version 1 not supported");case 2:return t.next=4,this.stream.getNextUint32();case 4:return n=t.sent,t.next=7,this.stream.getNextUint32();case 7:return s=t.sent,t.next=10,this.stream.getNextUint32();case 10:return i=t.sent,t.next=13,this.stream.getNextUint32();case 13:return a=t.sent,u="",t.next=17,this.stream.getNextUint16();case 17:return t.next=19,this.stream.getNextUint16();case 19:return t.abrupt("return",{header:e,type:"mdhd",fullBoxHeader:r,creationTime:n,modificationTime:s,timescale:i,duration:a,language:u});case 20:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),O=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"minf",vmhd:"vmhd"in r?r.vmhd[0]:void 0,stbl:r.stbl[0],dinf:r.dinf[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),E=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"stbl",stco:r.stco[0],stsc:r.stsc[0],stsd:r.stsd[0],stss:r.stss[0],stsz:r.stsz[0],stts:r.stts[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),F=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=13;break}return t.next=8,this.getNextChildBox();case 8:a=t.sent,s.push(a);case 10:i++,t.next=5;break;case 13:return t.abrupt("return",{header:e,type:"stsd",fullBoxHeader:r,entries:s});case 14:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),D=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s,i,a,u,c,h,f,p,x,d;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<6)){t.next=7;break}return t.next=4,this.stream.getNextUint8();case 4:r++,t.next=1;break;case 7:return t.next=9,this.stream.getNextUint16();case 9:n=t.sent,s=0;case 11:if(!(s<2)){t.next=17;break}return t.next=14,this.stream.getNextUint16();case 14:s++,t.next=11;break;case 17:i=0;case 18:if(!(i<3)){t.next=24;break}return t.next=21,this.stream.getNextUint32();case 21:i++,t.next=18;break;case 24:return t.next=26,this.stream.getNextUint16();case 26:return a=t.sent,t.next=29,this.stream.getNextUint16();case 29:return u=t.sent,t.next=32,this.stream.getNextUint32();case 32:return c=t.sent,t.next=35,this.stream.getNextUint32();case 35:return h=t.sent,t.next=38,this.stream.getNextUint32();case 38:return t.next=40,this.stream.getNextUint16();case 40:return f=t.sent,t.next=43,this.stream.getNextString(32);case 43:return p=t.sent,t.next=46,this.stream.getNextUint16();case 46:return x=t.sent,t.next=49,this.stream.getNextUint16();case 49:return t.next=51,this.getNextChildBox();case 51:return d=t.sent,t.abrupt("return",{header:e,type:"avc1",avcC:d,compressorName:p,dataReferenceIndex:n,depth:x,frameCount:f,height:u,horizontalResolution:c,verticalResolution:h,width:a});case 53:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),I=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s,i,a,u,c,h,f,p,x,d,l,m,v;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint8();case 2:return r=t.sent,t.next=5,this.stream.getNextUint8();case 5:return n=t.sent,t.next=8,this.stream.getNextUint8();case 8:return s=t.sent,t.next=11,this.stream.getNextUint8();case 11:return i=t.sent,t.next=14,this.stream.getNextUint8();case 14:return t.t0=t.sent,a=3&t.t0,t.next=18,this.stream.getNextUint8();case 18:t.t1=t.sent,u=31&t.t1,c=[],h=0;case 22:if(!(h<u)){t.next=33;break}return t.next=25,this.stream.getNextUint16();case 25:return f=t.sent,t.next=28,this.stream.getNextBytes(f);case 28:p=t.sent,c.push(p);case 30:h++,t.next=22;break;case 33:return t.next=35,this.stream.getNextUint8();case 35:x=t.sent,d=[],l=0;case 38:if(!(l<x)){t.next=49;break}return t.next=41,this.stream.getNextUint16();case 41:return m=t.sent,t.next=44,this.stream.getNextBytes(m);case 44:v=t.sent,d.push(v);case 46:l++,t.next=38;break;case 49:return t.abrupt("return",{header:e,type:"avcC",configurationVersion:r,profileIndication:n,profileCompatibility:s,levelIndication:i,lengthSizeMinusOne:a,sequenceParameterSets:c,pictureParameterSets:d});case 50:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),T=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=14;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 11:i++,t.next=5;break;case 14:return t.abrupt("return",{header:e,type:"stss",fullBoxHeader:r,sampleNumbers:s});case 15:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),M=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=14;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 11:i++,t.next=5;break;case 14:return t.abrupt("return",{header:e,type:"stco",fullBoxHeader:r,chunkOffsets:s});case 15:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),z=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=21;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:return t.t1=t.sent,t.next=12,this.stream.getNextUint32();case 12:return t.t2=t.sent,t.next=15,this.stream.getNextUint32();case 15:t.t3=t.sent,t.t4={firstChunk:t.t1,samplesPerChunk:t.t2,sampleDescriptionIndex:t.t3},t.t0.push.call(t.t0,t.t4);case 18:i++,t.next=5;break;case 21:return t.abrupt("return",{header:e,type:"stsc",fullBoxHeader:r,entries:s});case 22:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),H=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:return t.t0=t.sent,n=[t.t0],t.next=6,this.stream.getNextUint32();case 6:if(s=t.sent,0!==n[0]){t.next=19;break}n=[],i=0;case 10:if(!(i<s)){t.next=19;break}return t.t1=n,t.next=14,this.stream.getNextUint32();case 14:t.t2=t.sent,t.t1.push.call(t.t1,t.t2);case 16:i++,t.next=10;break;case 19:return t.abrupt("return",{header:e,type:"stsz",fullBoxHeader:r,sampleSizes:n,sampleCount:s});case 20:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),R=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=18;break}return t.t0=s,t.next=9,this.stream.getNextUint32();case 9:return t.t1=t.sent,t.next=12,this.stream.getNextUint32();case 12:t.t2=t.sent,t.t3={sampleCount:t.t1,sampleDelta:t.t2},t.t0.push.call(t.t0,t.t3);case 15:i++,t.next=5;break;case 18:return t.abrupt("return",{header:e,type:"stts",fullBoxHeader:r,entries:s});case 19:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),P=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return t.abrupt("return",{header:e,type:"udta"});case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),_=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:return t.next=4,this.stream.getNextString(4);case 4:n=t.sent,s=0;case 6:if(!(s<3)){t.next=12;break}return t.next=9,this.stream.getNextUint32();case 9:s++,t.next=6;break;case 12:return t.next=14,this.stream.getNextString();case 14:return i=t.sent,t.abrupt("return",{header:e,fullBoxHeader:r,type:"hdlr",handlerType:n,name:i});case 16:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),V=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint16();case 2:return n=t.sent,t.next=5,this.stream.getNextUint16();case 5:return t.t0=t.sent,t.next=8,this.stream.getNextUint16();case 8:return t.t1=t.sent,t.next=11,this.stream.getNextUint16();case 11:return t.t2=t.sent,s=[t.t0,t.t1,t.t2],t.abrupt("return",{header:e,fullBoxHeader:r,type:"vmhd",graphicsMode:n,opColor:s});case 14:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),q=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.getNextUint32();case 2:n=t.sent,s=[],i=0;case 5:if(!(i<n)){t.next=14;break}return t.t0=s,t.next=9,this.getNextChildBox();case 9:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 11:i++,t.next=5;break;case 14:return t.abrupt("return",{header:e,fullBoxHeader:r,type:"dref",entries:s});case 15:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),A=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildBoxes();case 2:return r=t.sent,t.abrupt("return",{header:e,type:"dinf",dref:r.dref[0]});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),L=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="",s="",1===r.flags){t.next=9;break}return t.next=5,this.stream.getNextString();case 5:return n=t.sent,t.next=8,this.stream.getNextString();case 8:s=t.sent;case 9:return t.abrupt("return",{header:e,fullBoxHeader:r,type:"urn ",name:n,location:s});case 10:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),W=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="",1===r.flags){t.next=5;break}return t.next=4,this.stream.getNextString();case 4:n=t.sent;case 5:return t.abrupt("return",{header:e,fullBoxHeader:r,type:"url ",location:n});case 6:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(k),G=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.stream.seek(this.header.endOffset),t.abrupt("return",{header:e,type:"unknown"});case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(w),j=r(1752),J=r(1120),K=r(7762);function Q(t,e){return X.apply(this,arguments)}function X(){return(X=(0,s.Z)(o().mark((function t(e,r){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n={"url ":it,"urn ":at,avc1:rt,avcC:et,dinf:ut,dref:ct,ftyp:tt,hdlr:ht,mdhd:mt,mdia:kt,minf:wt,moov:Zt,mvhd:yt,stbl:st,stco:ft,stsc:xt,stsd:nt,stss:lt,stsz:pt,stts:dt,tkhd:vt,trak:gt,vmhd:ot}[r.type])||console.warn("No writer available for %c".concat(r.type,", not writing."),"text-decoration: underline"),t.next=5,new n(e).write(r);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Y=function(){function t(e){(0,a.Z)(this,t),this.stream=e}return(0,u.Z)(t,[{key:"write",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.stream.offset,t.next=3,this.stream.skip(4);case 3:return t.next=5,this.stream.writeNextString(e.type,4);case 5:return t.next=7,this.writeContents(e);case 7:return n=this.stream.offset,s=n-r,t.next=11,this.stream.seek(r);case 11:return t.next=13,this.stream.writeNextUint32(s);case 13:return t.next=15,this.stream.seek(n);case 15:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),$=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.writeNextUint8(e.fullBoxHeader.version);case 2:return t.next=4,this.stream.writeNextUint8(e.fullBoxHeader.flags>>16);case 4:return t.next=6,this.stream.writeNextUint8(e.fullBoxHeader.flags>>8);case 6:return t.next=8,this.stream.writeNextUint8(e.fullBoxHeader.flags);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),tt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.writeNextString(e.majorBrand,4);case 2:return t.next=4,this.stream.writeNextUint32(e.minorVersion);case 4:r=(0,K.Z)(e.compatibleBrands),t.prev=5,r.s();case 7:if((n=r.n()).done){t.next=13;break}return s=n.value,t.next=11,this.stream.writeNextString(s,4);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),r.e(t.t0);case 18:return t.prev=18,r.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),et=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s,i,a,u;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.writeNextUint8(e.configurationVersion);case 2:return t.next=4,this.stream.writeNextUint8(e.profileIndication);case 4:return t.next=6,this.stream.writeNextUint8(e.profileCompatibility);case 6:return t.next=8,this.stream.writeNextUint8(e.levelIndication);case 8:return t.next=10,this.stream.writeNextUint8(252|e.lengthSizeMinusOne);case 10:return t.next=12,this.stream.writeNextUint8(224|e.sequenceParameterSets.length);case 12:r=(0,K.Z)(e.sequenceParameterSets),t.prev=13,r.s();case 15:if((n=r.n()).done){t.next=23;break}return s=n.value,t.next=19,this.stream.writeNextUint16(s.byteLength);case 19:return t.next=21,this.stream.writeNextBytes(s);case 21:t.next=15;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(13),r.e(t.t0);case 28:return t.prev=28,r.f(),t.finish(28);case 31:return t.next=33,this.stream.writeNextUint8(e.pictureParameterSets.length);case 33:i=(0,K.Z)(e.pictureParameterSets),t.prev=34,i.s();case 36:if((a=i.n()).done){t.next=44;break}return u=a.value,t.next=40,this.stream.writeNextUint16(u.byteLength);case 40:return t.next=42,this.stream.writeNextBytes(u);case 42:t.next=36;break;case 44:t.next=49;break;case 46:t.prev=46,t.t1=t.catch(34),i.e(t.t1);case 49:return t.prev=49,i.f(),t.finish(49);case 52:case"end":return t.stop()}}),t,this,[[13,25,28,31],[34,46,49,52]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),rt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stream.skip(6);case 2:return t.next=4,this.stream.writeNextUint16(e.dataReferenceIndex);case 4:return t.next=6,this.stream.skip(16);case 6:return t.next=8,this.stream.writeNextUint16(e.width);case 8:return t.next=10,this.stream.writeNextUint16(e.height);case 10:return t.next=12,this.stream.writeNextUint32(e.horizontalResolution);case 12:return t.next=14,this.stream.writeNextUint32(e.verticalResolution);case 14:return t.next=16,this.stream.skip(4);case 16:return t.next=18,this.stream.writeNextUint16(e.frameCount);case 18:return t.next=20,this.stream.writeNextString(e.compressorName,32);case 20:return t.next=22,this.stream.writeNextUint16(e.depth);case 22:return t.next=24,this.stream.writeNextUint16(65535);case 24:return t.next=26,Q(this.stream,e.avcC);case 26:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),nt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,K.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,Q(this.stream,i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),st=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(this.stream,e.stco);case 2:return t.next=4,Q(this.stream,e.stsc);case 4:return t.next=6,Q(this.stream,e.stsd);case 6:return t.next=8,Q(this.stream,e.stss);case 8:return t.next=10,Q(this.stream,e.stsz);case 10:return t.next=12,Q(this.stream,e.stts);case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),it=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextString(e.location);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}($),at=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:if(1===e.fullBoxHeader.flags){t.next=7;break}return t.next=5,this.stream.writeNextString(e.name);case 5:return t.next=7,this.stream.writeNextString(e.location);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}($),ut=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(this.stream,e.dref);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),ct=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,K.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,Q(this.stream,i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),ot=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint16(e.graphicsMode);case 4:n=(0,K.Z)(e.opColor),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,this.stream.writeNextUint16(i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),ht=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.skip(4);case 4:return t.next=6,this.stream.writeNextString(e.handlerType,4);case 6:return t.next=8,this.stream.skip(12);case 8:return t.next=10,this.stream.writeNextString(e.name);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}($),ft=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.chunkOffsets.length);case 4:n=(0,K.Z)(e.chunkOffsets),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),pt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.sampleSizes.length>1?0:e.sampleSizes[0]);case 4:return t.next=6,this.stream.writeNextUint32(e.sampleCount);case 6:n=(0,K.Z)(e.sampleSizes),t.prev=7,n.s();case 9:if((s=n.n()).done){t.next=15;break}return i=s.value,t.next=13,this.stream.writeNextUint32(i);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[7,17,20,23]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),xt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,K.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=17;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i.firstChunk);case 11:return t.next=13,this.stream.writeNextUint32(i.samplesPerChunk);case 13:return t.next=15,this.stream.writeNextUint32(i.sampleDescriptionIndex);case 15:t.next=7;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(5),n.e(t.t0);case 22:return t.prev=22,n.f(),t.finish(22);case 25:case"end":return t.stop()}}),t,this,[[5,19,22,25]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),dt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.entries.length);case 4:n=(0,K.Z)(e.entries),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=15;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i.sampleCount);case 11:return t.next=13,this.stream.writeNextUint32(i.sampleDelta);case 13:t.next=7;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[5,17,20,23]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),lt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.sampleNumbers.length);case 4:n=(0,K.Z)(e.sampleNumbers),t.prev=5,n.s();case 7:if((s=n.n()).done){t.next=13;break}return i=s.value,t.next=11,this.stream.writeNextUint32(i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),mt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.creationTime);case 4:return t.next=6,this.stream.writeNextUint32(e.modificationTime);case 6:return t.next=8,this.stream.writeNextUint32(e.timescale);case 8:return t.next=10,this.stream.writeNextUint32(e.duration);case 10:return t.next=12,this.stream.skip(2);case 12:return t.next=14,this.stream.skip(2);case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}($),vt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.creationTime);case 4:return t.next=6,this.stream.writeNextUint32(e.modificationTime);case 6:return t.next=8,this.stream.writeNextUint32(e.trackId);case 8:return t.next=10,this.stream.skip(4);case 10:return t.next=12,this.stream.writeNextUint32(e.duration);case 12:return t.next=14,this.stream.skip(8);case 14:return t.next=16,this.stream.writeNextUint16(e.layer);case 16:return t.next=18,this.stream.writeNextUint16(e.alternateGroup);case 18:return t.next=20,this.stream.writeNextUint16(e.volume);case 20:return t.next=22,this.stream.skip(2);case 22:n=(0,K.Z)(e.matrix),t.prev=23,n.s();case 25:if((s=n.n()).done){t.next=31;break}return i=s.value,t.next=29,this.stream.writeNextUint32(i);case 29:t.next=25;break;case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(23),n.e(t.t0);case 36:return t.prev=36,n.f(),t.finish(36);case 39:return t.next=41,this.stream.writeNextUint32(e.width);case 41:return t.next=43,this.stream.writeNextUint32(e.height);case 43:case"end":return t.stop()}}),t,this,[[23,33,36,39]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),yt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,j.Z)((0,J.Z)(r.prototype),"writeContents",this).call(this,e);case 2:return t.next=4,this.stream.writeNextUint32(e.creationTime);case 4:return t.next=6,this.stream.writeNextUint32(e.modificationTime);case 6:return t.next=8,this.stream.writeNextUint32(e.timescale);case 8:return t.next=10,this.stream.writeNextUint32(e.duration);case 10:return t.next=12,this.stream.writeNextUint32(e.rate);case 12:return t.next=14,this.stream.writeNextUint16(e.volume);case 14:return t.next=16,this.stream.skip(10);case 16:n=(0,K.Z)(e.matrix),t.prev=17,n.s();case 19:if((s=n.n()).done){t.next=25;break}return i=s.value,t.next=23,this.stream.writeNextUint32(i);case 23:t.next=19;break;case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(17),n.e(t.t0);case 30:return t.prev=30,n.f(),t.finish(30);case 33:return t.next=35,this.stream.skip(24);case 35:return t.next=37,this.stream.writeNextUint32(e.nextTrackId);case 37:case"end":return t.stop()}}),t,this,[[17,27,30,33]])})));return function(e){return t.apply(this,arguments)}}()}]),r}($),wt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(this.stream,e.vmhd);case 2:return t.next=4,Q(this.stream,e.dinf);case 4:return t.next=6,Q(this.stream,e.stbl);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),kt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(this.stream,e.mdhd);case 2:return t.next=4,Q(this.stream,e.hdlr);case 4:return t.next=6,Q(this.stream,e.minf);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),gt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(this.stream,e.tkhd);case 2:return t.next=4,Q(this.stream,e.mdia);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),Zt=function(t){(0,d.Z)(r,t);var e=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),e.apply(this,arguments)}return(0,u.Z)(r,[{key:"writeContents",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(this.stream,e.mvhd);case 2:r=(0,K.Z)(e.trak),t.prev=3,r.s();case 5:if((n=r.n()).done){t.next=11;break}return s=n.value,t.next=9,Q(this.stream,s);case 9:t.next=5;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:case"end":return t.stop()}}),t,this,[[3,13,16,19]])})));return function(e){return t.apply(this,arguments)}}()}]),r}(Y),bt=function(){function t(e){(0,a.Z)(this,t),this.stream=e,this.startOffset=0,this.opened=!1,this.closed=!1}return(0,u.Z)(t,[{key:"open",value:function(){var t=(0,s.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.opened){t.next=4;break}throw new Error("already opened");case 4:if(!this.closed){t.next=6;break}throw new Error("already closed");case 6:return this.startOffset=this.stream.offset,t.next=9,this.stream.skip(4);case 9:return t.next=11,this.stream.writeNextString("mdat",4);case 11:this.opened=!0;case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"write",value:function(){var t=(0,s.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.opened){t.next=4;break}throw new Error("not opened");case 4:if(!this.closed){t.next=6;break}throw new Error("already closed");case 6:return t.next=8,this.stream.writeNextBytes(e);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.opened){t.next=4;break}throw new Error("not opened");case 4:if(!this.closed){t.next=6;break}throw new Error("already closed");case 6:return e=this.stream.offset,t.next=9,this.stream.seek(this.startOffset);case 9:return t.next=11,this.stream.writeNextUint32(e-this.startOffset);case 11:return t.next=13,this.stream.seek(e);case 13:this.closed=!0;case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"dataStartOffset",get:function(){if(!this.opened)throw new Error("not opened");return this.startOffset+8}}]),t}(),Nt=function(){function t(e){(0,a.Z)(this,t),this.stream=void 0,this.mdat=void 0,this.moov=void 0,this.stream=new p(e)}return(0,u.Z)(t,[{key:"parse",value:function(){var t=(0,s.Z)(o().mark((function t(){var e,r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.parseBox();case 2:if("ftyp"===t.sent.type){t.next=5;break}throw new Error("Expected ftyp box at start of file. Not an MP4?");case 5:if(this.stream.eof){t.next=19;break}return t.next=8,this.parseBox();case 8:n=t.sent,t.t0=n.type,t.next="mdat"===t.t0?12:"moov"===t.t0?14:16;break;case 12:return e=n,t.abrupt("break",17);case 14:return r=n,t.abrupt("break",17);case 16:return t.abrupt("break",17);case 17:t.next=5;break;case 19:if(e&&r){t.next=21;break}throw new Error("Missing mdat or moov box");case 21:this.mdat=e,this.moov=r;case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getSample",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r,n,s,i,a,u,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=this.moov.trak[0].mdia.minf.stbl,n=r.stsz,s=r.stco,i=n.sampleSizes[e],a=s.chunkOffsets[0],u=a,c=0;c<e;c++)u+=r.stsz.sampleSizes[c];return this.stream.seek(u),t.next=10,this.stream.getNextBytes(i);case 10:return t.t0=t.sent,t.t1=this.isSampleSync(e),t.abrupt("return",{data:t.t0,sync:t.t1});case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"isSampleSync",value:function(t){return this.moov.trak[0].mdia.minf.stbl.stss.sampleNumbers.includes(t+1)}},{key:"parseBox",value:function(){var t=(0,s.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(this.stream);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),Ut=function(){function t(e){(0,a.Z)(this,t),this.stream=void 0,this.mdat=void 0,this.avcC=void 0,this.sampleCount=0,this.syncSamples=[],this.sampleSizes=[],this.displaySize=void 0,this.stream=new x(e),this.mdat=new bt(this.stream)}return(0,u.Z)(t,[{key:"open",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={type:"ftyp",majorBrand:"isom",minorVersion:0,compatibleBrands:["mp41","avc1","isom"]},t.next=3,Q(this.stream,e);case 3:return t.next=5,this.mdat.open();case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"writeSample",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.mdat.write(e);case 2:r&&this.syncSamples.push(this.sampleCount+1),this.sampleSizes.push(e instanceof Blob?e.size:e.byteLength),this.sampleCount++;case 5:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"setAvcC",value:function(t){var e,r={type:"avcC",configurationVersion:(e=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength)).getUint8(0),profileIndication:e.getUint8(1),profileCompatibility:e.getUint8(2),levelIndication:e.getUint8(3),lengthSizeMinusOne:3&e.getUint8(4),sequenceParameterSets:[],pictureParameterSets:[]},n=5,s=31&e.getUint8(n);n+=1;for(var i=[],a=0;a<s;a++){var u=e.getUint16(n);n+=2;var c=new Uint8Array(e.buffer,e.byteOffset+n,u);i.push(c),n+=u}var o=e.getUint8(n);n+=1;for(var h=[],f=0;f<o;f++){var p=e.getUint16(n);n+=2;var x=new Uint8Array(e.buffer,e.byteOffset+n,p);h.push(x),n+=p}r.sequenceParameterSets=i,r.pictureParameterSets=h,this.avcC=r}},{key:"setDisplaySize",value:function(t){this.displaySize={width:t.width,height:t.height}}},{key:"close",value:function(){var t=(0,s.Z)(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.mdat.close();case 2:return e={type:"moov",mvhd:this.getMvhdBox(),trak:[this.getTrakBox()]},t.next=5,Q(this.stream,e);case 5:return t.next=7,this.stream.close();case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getTrakBox",value:function(){return{type:"trak",tkhd:this.getTkhdBox(),mdia:this.getMdiaBox()}}},{key:"getTkhdBox",value:function(){var t=new Date("1904-01-01T00:00:00Z"),e=new Date,r=Math.floor((e.getTime()-t.getTime())/1e3);return{type:"tkhd",fullBoxHeader:{version:0,flags:3},alternateGroup:0,creationTime:r,duration:60*this.sampleCount,width:this.displaySize.width,height:this.displaySize.height,layer:0,matrix:[65536,0,0,0,65536,0,0,0,1073741824],modificationTime:r,trackId:1,volume:0}}},{key:"getMvhdBox",value:function(){var t=new Date("1904-01-01T00:00:00Z"),e=new Date,r=Math.floor((e.getTime()-t.getTime())/1e3);return{type:"mvhd",fullBoxHeader:{version:0,flags:0},duration:Math.floor(1e3*this.sampleCount/60),creationTime:r,modificationTime:r,timescale:1e3,rate:65536,volume:256,matrix:[65536,0,0,0,65536,0,0,0,1073741824],nextTrackId:2}}},{key:"getMdiaBox",value:function(){return{type:"mdia",hdlr:{type:"hdlr",fullBoxHeader:{version:0,flags:0},handlerType:"vide",name:"VideoHandler"},minf:this.getMinfBox(),mdhd:this.getMdhdBox()}}},{key:"getMdhdBox",value:function(){var t=new Date("1904-01-01T00:00:00Z"),e=new Date,r=Math.floor((e.getTime()-t.getTime())/1e3);return{type:"mdhd",fullBoxHeader:{version:0,flags:0},creationTime:r,duration:this.sampleCount,language:"",modificationTime:r,timescale:60}}},{key:"getMinfBox",value:function(){var t=this.getStblBox();return{type:"minf",dinf:this.getDinfBox(),stbl:t,vmhd:{type:"vmhd",fullBoxHeader:{version:0,flags:1},graphicsMode:0,opColor:[0,0,0]}}}},{key:"getDinfBox",value:function(){return{type:"dinf",dref:{type:"dref",fullBoxHeader:{version:0,flags:0},entries:[{type:"url ",fullBoxHeader:{version:0,flags:1},location:""}]}}}},{key:"getStblBox",value:function(){return{type:"stbl",stco:{type:"stco",fullBoxHeader:{version:0,flags:0},chunkOffsets:[this.mdat.dataStartOffset]},stsc:{type:"stsc",fullBoxHeader:{version:0,flags:0},entries:[{firstChunk:1,samplesPerChunk:this.sampleCount,sampleDescriptionIndex:1}]},stsd:{type:"stsd",fullBoxHeader:{version:0,flags:0},entries:[{type:"avc1",dataReferenceIndex:1,width:this.displaySize.width,height:this.displaySize.height,horizontalResolution:4718592,verticalResolution:4718592,frameCount:1,compressorName:"mp4.ts",depth:24,avcC:this.avcC}]},stss:{type:"stss",fullBoxHeader:{version:0,flags:0},sampleNumbers:this.syncSamples},stsz:{type:"stsz",fullBoxHeader:{version:0,flags:0},sampleCount:this.sampleCount,sampleSizes:this.sampleSizes},stts:{type:"stts",fullBoxHeader:{version:0,flags:0},entries:[{sampleCount:this.sampleCount,sampleDelta:1}]}}}}]),t}();function Bt(t){var e=new f.StreamDataView(void 0,!0);e.setNextUint8(t.configurationVersion),e.setNextUint8(t.profileIndication),e.setNextUint8(t.profileCompatibility),e.setNextUint8(t.levelIndication),e.setNextUint8(t.lengthSizeMinusOne+252),e.setNextUint8(t.sequenceParameterSets.length+224);for(var r=0;r<t.sequenceParameterSets.length;r++){e.setNextUint16(t.sequenceParameterSets[r].length);for(var n=0;n<t.sequenceParameterSets[r].length;n++)e.setNextUint8(t.sequenceParameterSets[r][n])}e.setNextUint8(t.pictureParameterSets.length);for(var s=0;s<t.pictureParameterSets.length;s++){e.setNextUint16(t.pictureParameterSets[s].length);for(var i=0;i<t.pictureParameterSets[s].length;i++)e.setNextUint8(t.pictureParameterSets[s][i])}return e.getBuffer()}var Ct=function(){function t(e){(0,a.Z)(this,t),this.decoder=void 0,this.encoder=void 0,this.inMp4=void 0,this.outMp4=void 0,this.expectedFrames=0,this.framesDecoded=0,this.framesEncoded=0,this.queuedForDecode=0,this.queuedForEncode=0,this.infoReady=void 0,this.modifyFrame=void 0,this.progressInit=void 0,this.progressUpdate=void 0,this.infoReady=e.infoReady,this.modifyFrame=e.modifyFrame,this.progressInit=e.progressInit,this.progressUpdate=e.progressUpdate}return(0,u.Z)(t,[{key:"reset",value:function(){this.encoder&&this.encoder.close(),this.encoder=new VideoEncoder({output:this.handleEncodedFrame.bind(this),error:this.handleEncoderError.bind(this)}),this.decoder&&this.decoder.close(),this.decoder=new VideoDecoder({output:this.handleDecodedFrame.bind(this),error:this.handleDecoderError.bind(this)})}},{key:"processFile",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.reset(),this.inMp4=new Nt(e),t.next=4,this.inMp4.parse();case 4:return this.outMp4=new Ut(r),t.next=7,this.outMp4.open();case 7:n=this.inMp4.moov.trak[0].mdia.minf.stbl.stsd.entries[0],s="avc1."+n.avcC.profileIndication.toString(16).padStart(2,"0")+n.avcC.profileCompatibility.toString(16).padStart(2,"0")+n.avcC.levelIndication.toString(16).padStart(2,"0"),this.decoder.configure({codec:s,codedWidth:this.inMp4.moov.trak[0].tkhd.width,codedHeight:this.inMp4.moov.trak[0].tkhd.height,description:Bt(this.inMp4.moov.trak[0].mdia.minf.stbl.stsd.entries[0].avcC),optimizeForLatency:!1}),this.infoReady(this.inMp4.moov.trak[0].tkhd.width,this.inMp4.moov.trak[0].tkhd.height);case 11:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"processSamples",value:function(t){var e;this.encoder.configure({codec:"avc1.42003d",width:t.width,height:t.height,bitrate:5e7,framerate:60,latencyMode:"quality"}),null===(e=this.outMp4)||void 0===e||e.setDisplaySize({width:t.width,height:t.height}),this.framesDecoded=0,this.framesEncoded=0,this.queuedForDecode=0,this.queuedForEncode=0,this.expectedFrames=this.inMp4.moov.trak[0].mdia.mdhd.duration,this.progressInit(this.expectedFrames),this.decodeNextSamples()}},{key:"decodeNextSamples",value:function(){var t=(0,s.Z)(o().mark((function t(){var e,r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.expectedFrames-this.queuedForDecode<=0)){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.inMp4.getSample(this.queuedForDecode);case 5:if(!((r=t.sent).data.byteLength<=100)){t.next=14;break}return console.debug("Skipping tiny frame"),this.queuedForDecode++,this.framesDecoded++,this.queuedForEncode++,this.framesEncoded++,this.decodeNextSamples(),t.abrupt("return");case 14:n=new EncodedVideoChunk({type:r.sync?"key":"delta",timestamp:0,duration:60,data:r.data.buffer}),this.decoder.decode(n),this.queuedForDecode++,null!==(e=this.inMp4)&&void 0!==e&&e.isSampleSync(this.queuedForDecode)&&this.decoder.flush();case 19:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleDecodedFrame",value:function(t){var e=this;this.framesDecoded%60===0&&(console.debug("Flushing encoder at decoded frame ".concat(this.framesDecoded,", keyframe incoming.")),this.encoder.flush());var r=this.modifyFrame(t,this.framesDecoded);t.close(),this.encoder.encode(r,{keyFrame:this.framesDecoded%60===0}),this.queuedForEncode++,this.framesDecoded%60===0&&createImageBitmap(r).then((function(t){e.progressUpdate(void 0,t)})),r.close(),this.framesDecoded++,this.framesDecoded===this.expectedFrames-1&&(console.debug("Flushing encoder at decoded frame ".concat(this.framesDecoded,", last frame.")),this.encoder.flush())}},{key:"handleEncodedFrame",value:function(){var t=(0,s.Z)(o().mark((function t(e,r){var n,s,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return 0===this.framesEncoded&&this.outMp4.setAvcC(null===(n=r.decoderConfig)||void 0===n?void 0:n.description),s=new ArrayBuffer(e.byteLength),e.copyTo(s),t.next=5,this.outMp4.writeSample(s,"key"===e.type);case 5:if(this.progressUpdate(this.framesEncoded),this.framesEncoded++,this.framesEncoded!==this.expectedFrames-1){t.next=13;break}return t.next=10,null===(i=this.outMp4)||void 0===i?void 0:i.close();case 10:postMessage({type:h.MessageType.FILE_OUT}),t.next=14;break;case 13:this.decodeNextSamples();case 14:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"handleDecoderError",value:function(t){throw console.log(this.expectedFrames,this.framesDecoded),t}},{key:"handleEncoderError",value:function(t){throw t}}]),t}(),St=256,Ot=function(){function t(e,r){(0,a.Z)(this,t),this.name=void 0,this.tiles=void 0,this.name=e,this.tiles=r}return(0,u.Z)(t,[{key:"getTile",value:function(t){return this.tiles[t]}}],[{key:"fromFile",value:function(){var e=(0,s.Z)(o().mark((function e(r){var n,s,i,a,u,c,h,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.arrayBuffer();case 2:n=e.sent,s=r.name.includes("hd"),i=s?24:36,a=s?36:54,u=[],c=0;case 8:if(!(c<St)){e.next=18;break}return h=new Uint8ClampedArray(n,c*i*a*4,i*a*4),f=new ImageData(h,i,a),e.next=13,createImageBitmap(f);case 13:p=e.sent,u.push(p);case 15:c++,e.next=8;break;case 18:return e.abrupt("return",new t(r.name,u));case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fromFiles",value:function(){var e=(0,s.Z)(o().mark((function e(r){var n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map((function(e){return t.fromFile(e)})),e.next=3,Promise.all(n);case 3:return s=e.sent,e.abrupt("return",{sd1:s.find((function(t){return!t.name.includes("_2")&&!t.name.includes("hd")})),sd2:s.find((function(t){return t.name.includes("_2")&&!t.name.includes("hd")})),hd1:s.find((function(t){return!t.name.includes("_2")&&t.name.includes("hd")})),hd2:s.find((function(t){return t.name.includes("_2")&&t.name.includes("hd")}))});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),t}(),Et=function(){function t(e){(0,a.Z)(this,t),this.header=void 0,this.frames=[];var r=new f.StreamDataView(e);for(this.header={magic:r.getNextString(7),version:r.getNextUint16(),config:{charWidth:r.getNextUint8(),charHeight:r.getNextUint8(),fontWidth:r.getNextUint8(),fontHeight:r.getNextUint8(),xOffset:r.getNextUint16(),yOffset:r.getNextUint16(),fontVariant:r.getNextUint8()}},31===this.header.config.charWidth&&(this.header.config.charWidth=30);r.getOffset()<e.byteLength;)try{var n=r.getNextUint32(),s=r.getNextUint32(),i=new Uint16Array(e,r.getOffset(),s);r.setOffset(r.getOffset()+2*s),this.frames.push({frameNumber:n,frameSize:s,frameData:i})}catch(u){if(u instanceof RangeError){console.warn("No more data in OSD file, probably truncated due to power loss");break}}}return(0,u.Z)(t,null,[{key:"fromFile",value:function(){var e=(0,s.Z)(o().mark((function e(r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.arrayBuffer();case 2:return n=e.sent,e.abrupt("return",new t(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),t}(),Ft=function(){function t(){(0,a.Z)(this,t),this.processor=void 0,this.fontPack=void 0,this.osdReader=void 0,this.lastOsdIndex=0,this.wide=!1,this.hd=!1,this.outWidth=void 0,this.outHeight=void 0,this.osdCanvas=void 0,this.osdCtx=void 0,this.frameCanvas=void 0,this.frameCtx=void 0,this.processor=new Ct({infoReady:this.infoReady.bind(this),modifyFrame:this.modifyFrame.bind(this),progressInit:this.progressInit.bind(this),progressUpdate:this.progressUpdate.bind(this)}),addEventListener("message",this.onMessage.bind(this))}return(0,u.Z)(t,[{key:"infoReady",value:function(t,e){var r,n;1280===t&&720===e&&(this.wide=!0),24===this.osdReader.header.config.fontWidth&&(this.hd=!0),this.wide||this.hd?(r=1280,n=720):(r=t,n=e),this.outWidth=r,this.outHeight=n,this.osdCanvas=new OffscreenCanvas(this.osdReader.header.config.fontWidth*this.osdReader.header.config.charWidth,this.osdReader.header.config.fontHeight*this.osdReader.header.config.charHeight),this.osdCtx=this.osdCanvas.getContext("2d"),this.frameCanvas=new OffscreenCanvas(this.outWidth,this.outHeight),this.frameCtx=this.frameCanvas.getContext("2d"),this.processor.processSamples({width:r,height:n})}},{key:"modifyFrame",value:function(t,e){var r,n=this.osdCanvas,s=this.osdCtx,i=this.frameCanvas,a=this.frameCtx;if(a.fillStyle="black",a.fillRect(0,0,i.width,i.height),s.clearRect(0,0,n.width,n.height),r=this.hd||this.wide?(this.outWidth-t.displayWidth)/2:0,a.drawImage(t,r,0),this.lastOsdIndex<this.osdReader.frames.length-1){var u=this.lastOsdIndex+1;e>=this.osdReader.frames[u].frameNumber&&(this.lastOsdIndex=u)}for(var c=this.osdReader.frames[this.lastOsdIndex],o=0;o<22;o++)for(var h=0;h<60;h++){var f=o+22*h,p=c.frameData[f],x=void 0;x=this.hd?p<St?this.fontPack.hd1:this.fontPack.hd2:p<St?this.fontPack.sd1:this.fontPack.sd2,s.drawImage(x.getTile(p%St),h*this.osdReader.header.config.fontWidth,o*this.osdReader.header.config.fontHeight)}var d=i.height/n.height,l=n.width*d,m=n.height*d,v=(i.width-l)/2,y=(i.height-m)/2;return a.drawImage(n,v,y,l,m),new VideoFrame(i,{timestamp:t.timestamp})}},{key:"progressInit",value:function(t){postMessage({type:h.MessageType.PROGRESS_INIT,expectedFrames:t})}},{key:"progressUpdate",value:function(t,e){postMessage({type:h.MessageType.PROGRESS_UPDATE,currentFrame:t,preview:e},(0,i.Z)(e?[e]:[]))}},{key:"onMessage",value:function(){var t=(0,s.Z)(o().mark((function t(e){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.data,t.t0=r.type,t.next=t.t0===h.MessageType.FILE_IN?4:17;break;case 4:return console.debug("Hello from the worker!"),t.next=7,Et.fromFile(r.osdFile);case 7:return this.osdReader=t.sent,console.debug("Got OSD reader"),t.next=11,Ot.fromFiles(r.fontFiles);case 11:return this.fontPack=t.sent,console.debug("Got font pack"),console.debug("Starting processor..."),t.next=16,this.processor.processFile(r.videoFile,r.outHandle);case 16:return t.abrupt("break",18);case 17:throw new Error("Unknown message type received");case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}();new Ft}},e={};function r(n){var s=e[n];if(void 0!==s)return s.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.m=t,r.x=function(){var t=r.O(void 0,[735],(function(){return r(451)}));return t=r.O(t)},function(){var t=[];r.O=function(e,n,s,i){if(!n){var a=1/0;for(h=0;h<t.length;h++){n=t[h][0],s=t[h][1],i=t[h][2];for(var u=!0,c=0;c<n.length;c++)(!1&i||a>=i)&&Object.keys(r.O).every((function(t){return r.O[t](n[c])}))?n.splice(c--,1):(u=!1,i<a&&(a=i));if(u){t.splice(h--,1);var o=s();void 0!==o&&(e=o)}}return e}i=i||0;for(var h=t.length;h>0&&t[h-1][2]>i;h--)t[h]=t[h-1];t[h]=[n,s,i]}}(),r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.f={},r.e=function(t){return Promise.all(Object.keys(r.f).reduce((function(e,n){return r.f[n](t,e),e}),[]))},r.u=function(t){return"static/js/"+t+".2905a6ff.chunk.js"},r.miniCssF=function(t){},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",function(){var t={451:1};r.f.i=function(e,n){t[e]||importScripts(r.p+r.u(e))};var e=self.webpackChunkwtfos_configurator=self.webpackChunkwtfos_configurator||[],n=e.push.bind(e);e.push=function(e){var s=e[0],i=e[1],a=e[2];for(var u in i)r.o(i,u)&&(r.m[u]=i[u]);for(a&&a(r);s.length;)t[s.pop()]=1;n(e)}}(),function(){var t=r.x;r.x=function(){return r.e(735).then(t)}}();r.x()}();
//# sourceMappingURL=451.fdc626c2.chunk.js.map