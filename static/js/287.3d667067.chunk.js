!function(){"use strict";var e={9287:function(e,t,i){var n,r=i(5861),s=i(5671),o=i(3144),a=i(7757),d=i.n(a);!function(e){var t;!function(e){e[e.FILE_IN=0]="FILE_IN",e[e.FILE_OUT=1]="FILE_OUT",e[e.PROGRESS_INIT=2]="PROGRESS_INIT",e[e.PROGRESS_UPDATE=3]="PROGRESS_UPDATE"}(t||(t={})),e.MessageType=t}(n||(n={}));var c=n,h=i(7762),u=i(70),f=i(7449);function l(e){var t=new f.StreamDataView(void 0,!0);t.setNextUint8(e.configurationVersion),t.setNextUint8(e.AVCProfileIndication),t.setNextUint8(e.profile_compatibility),t.setNextUint8(e.AVCLevelIndication),t.setNextUint8(e.lengthSizeMinusOne+252),t.setNextUint8(e.nb_SPS_nalus+224);for(var i=0;i<e.SPS.length;i++){t.setNextUint16(e.SPS[i].length);for(var n=0;n<e.SPS[i].length;n++)t.setNextUint8(e.SPS[i].nalu[n])}t.setNextUint8(e.nb_PPS_nalus);for(var r=0;r<e.PPS.length;r++){t.setNextUint16(e.PPS[r].length);for(var s=0;s<e.PPS[r].length;s++)t.setNextUint8(e.PPS[r].nalu[s])}if(e.ext)for(var o=0;o<e.ext.length;o++)t.setNextUint8(e.ext[o]);return t.getBuffer()}var p=function(){function e(t){(0,s.Z)(this,e),this.decoder=void 0,this.encoder=void 0,this.inFile=void 0,this.inInfo=void 0,this.outFile=void 0,this.expectedFrames=0,this.currentDecodingFrame=0,this.currentEncodingFrame=0,this.outTrackId=void 0,this.infoReady=void 0,this.modifyFrame=void 0,this.progressInit=void 0,this.progressUpdate=void 0,this.infoReady=t.infoReady,this.modifyFrame=t.modifyFrame,this.progressInit=t.progressInit,this.progressUpdate=t.progressUpdate}return(0,o.Z)(e,[{key:"reset",value:function(){this.inFile=u.createFile(),this.inFile.onReady=this.onInInfoReady.bind(this),this.inFile.onSamples=this.onInSamples.bind(this),this.outFile=u.createFile(),this.encoder&&this.encoder.close(),this.encoder=new VideoEncoder({output:this.handleEncodedFrame.bind(this),error:this.handleEncoderError.bind(this)}),this.decoder&&this.decoder.close(),this.decoder=new VideoDecoder({output:this.handleDecodedFrame.bind(this),error:this.handleDecoderError.bind(this)})}},{key:"processFile",value:function(){var e=(0,r.Z)(d().mark((function e(t){var i,n,r,s,o,a,c,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.reset(),this.currentDecodingFrame=0,this.currentEncodingFrame=0,this.expectedFrames=0,this.outTrackId=void 0,i=t.stream(),n=i.getReader(),r=0,s=!1;case 9:if(!s){e.next=18;break}return e.next=12,n.read();case 12:o=e.sent,a=o.done,c=o.value,a||((h=c.buffer).fileStart=r,this.inFile.appendBuffer(h),r+=c.byteLength),e.next=9;break;case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processSamples",value:function(e){if(!this.inInfo)throw new Error("No info?");this.encoder.configure({codec:"avc1.42003d",width:e.width,height:e.height,bitrate:this.inInfo.videoTracks[0].bitrate,framerate:60}),this.expectedFrames=this.inInfo.videoTracks[0].nb_samples,this.currentEncodingFrame=0,this.progressInit(this.expectedFrames),this.inFile.setExtractionOptions(this.inInfo.videoTracks[0].id),this.inFile.start(),this.inFile.flush()}},{key:"onInInfoReady",value:function(e){this.inInfo=e,this.decoder.configure({codec:e.videoTracks[0].codec,codedWidth:e.videoTracks[0].track_width,codedHeight:e.videoTracks[0].track_height,description:l(this.inFile.moov.traks[0].mdia.minf.stbl.stsd.entries[0].avcC)}),this.infoReady(e)}},{key:"onInSamples",value:function(e,t,i){var n,r=(0,h.Z)(i);try{for(r.s();!(n=r.n()).done;){var s=n.value,o=new EncodedVideoChunk({data:s.data,duration:Math.floor(s.duration/s.timescale*1e6),timestamp:Math.floor(s.dts/s.timescale*1e6),type:s.is_sync?"key":"delta"});this.decoder.decode(o)}}catch(a){r.e(a)}finally{r.f()}}},{key:"handleDecodedFrame",value:function(e){var t=this,i=this.modifyFrame(e,this.currentDecodingFrame);e.close(),this.encoder.encode(i,{keyFrame:this.currentDecodingFrame%60===0}),this.currentDecodingFrame%60===0&&createImageBitmap(i).then((function(e){t.progressUpdate(void 0,e)})),this.currentDecodingFrame++,i.close()}},{key:"handleDecoderError",value:function(e){throw e}},{key:"handleEncodedFrame",value:function(e,t){var i;this.outTrackId||(this.outTrackId=this.outFile.addTrack({avcDecoderConfigRecord:null===(i=t.decoderConfig)||void 0===i?void 0:i.description,height:this.inInfo.videoTracks[0].track_height,nb_samples:this.inInfo.videoTracks[0].nb_samples,timescale:this.inInfo.videoTracks[0].timescale,width:this.inInfo.videoTracks[0].track_width}));var n=new ArrayBuffer(e.byteLength);if(e.copyTo(n),this.outFile.addSample(this.outTrackId,n,{cts:this.currentEncodingFrame,dts:this.currentEncodingFrame,duration:1,is_sync:"key"===e.type}),this.progressUpdate(this.currentEncodingFrame),this.currentEncodingFrame++,this.currentEncodingFrame===this.expectedFrames){var r=this.outFile.getBuffer(),s=new Blob([r],{type:"video/mp4"}),o=URL.createObjectURL(s);postMessage({type:c.MessageType.FILE_OUT,blobString:o})}}},{key:"handleEncoderError",value:function(e){console.error(e)}}]),e}(),v=function(){function e(t,i){(0,s.Z)(this,e),this.name=void 0,this.tiles=void 0,this.name=t,this.tiles=i}return(0,o.Z)(e,[{key:"getTile",value:function(e){return this.tiles[e]}}],[{key:"fromFile",value:function(){var t=(0,r.Z)(d().mark((function t(i){var n,r,s,o,a,c,h,u,f;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.arrayBuffer();case 2:n=t.sent,r=i.name.includes("hd"),s=r?24:36,o=r?36:54,a=[],c=0;case 8:if(!(c<256)){t.next=18;break}return h=new Uint8ClampedArray(n,c*s*o*4,s*o*4),u=new ImageData(h,s,o),t.next=13,createImageBitmap(u);case 13:f=t.sent,a.push(f);case 15:c++,t.next=8;break;case 18:return t.abrupt("return",new e(i.name,a));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"fromFiles",value:function(){var t=(0,r.Z)(d().mark((function t(i){var n,r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.map((function(t){return e.fromFile(t)})),t.next=3,Promise.all(n);case 3:return r=t.sent,t.abrupt("return",{sd1:r.find((function(e){return!e.name.includes("_2")&&!e.name.includes("hd")})),sd2:r.find((function(e){return e.name.includes("_2")&&!e.name.includes("hd")})),hd1:r.find((function(e){return!e.name.includes("_2")&&e.name.includes("hd")})),hd2:r.find((function(e){return e.name.includes("_2")&&e.name.includes("hd")}))});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),m=function(){function e(t){(0,s.Z)(this,e),this.header=void 0,this.frames=[];var i=new f.StreamDataView(t);for(this.header={magic:i.getNextString(7),version:i.getNextUint16(),config:{charWidth:i.getNextUint8(),charHeight:i.getNextUint8(),fontWidth:i.getNextUint8(),fontHeight:i.getNextUint8(),xOffset:i.getNextUint16(),yOffset:i.getNextUint16(),fontVariant:i.getNextUint8()}};i.getOffset()<t.byteLength;){var n=i.getNextUint32(),r=i.getNextUint32(),o=new Uint16Array(t,i.getOffset(),r);i.setOffset(i.getOffset()+2*r),this.frames.push({frameNumber:n,frameSize:r,frameData:o})}}return(0,o.Z)(e,null,[{key:"fromFile",value:function(){var t=(0,r.Z)(d().mark((function t(i){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.arrayBuffer();case 2:return n=t.sent,t.abrupt("return",new e(n));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),g=function(){function e(){(0,s.Z)(this,e),this.processor=void 0,this.fontPack=void 0,this.osdReader=void 0,this.lastOsdIndex=0,this.wide=!1,this.hd=!1,this.outWidth=void 0,this.outHeight=void 0,this.processor=new p({infoReady:this.infoReady.bind(this),modifyFrame:this.modifyFrame.bind(this),progressInit:this.progressInit.bind(this),progressUpdate:this.progressUpdate.bind(this)}),addEventListener("message",this.onMessage.bind(this))}return(0,o.Z)(e,[{key:"infoReady",value:function(e){var t,i,n=e.videoTracks[0].track_width,r=e.videoTracks[0].track_height;1280===n&&720===r&&(this.wide=!0),24===this.osdReader.header.config.fontWidth&&(this.hd=!0),this.wide||this.hd?(t=1280,i=720):(t=n,i=r),this.outWidth=t,this.outHeight=i,this.processor.processSamples({width:t,height:i})}},{key:"modifyFrame",value:function(e,t){var i,n=new OffscreenCanvas((this.hd?24:36)*this.osdReader.header.config.charWidth,(this.hd?36:54)*this.osdReader.header.config.charHeight),r=n.getContext("2d"),s=new OffscreenCanvas(this.outWidth,this.outHeight),o=s.getContext("2d");if(i=this.hd||this.wide?(this.outWidth-e.codedWidth)/2:0,o.drawImage(e,i,0),this.lastOsdIndex<this.osdReader.frames.length-1){var a=this.lastOsdIndex+1;t>=this.osdReader.frames[a].frameNumber&&(this.lastOsdIndex=a)}for(var d,c=this.osdReader.frames[this.lastOsdIndex],h=0;h<22;h++)for(var u=0;u<60;u++){var f=h+22*u,l=c.frameData[f],p=void 0;p=this.hd?l<256?this.fontPack.hd1:this.fontPack.hd2:l<256?this.fontPack.sd1:this.fontPack.sd2,r.drawImage(p.getTile(l),u*this.osdReader.header.config.fontWidth,h*this.osdReader.header.config.fontHeight)}return d=this.hd||this.wide?this.osdReader.header.config.xOffset:0,o.drawImage(n,d,0,s.width,s.height),new VideoFrame(s,{timestamp:e.timestamp})}},{key:"progressInit",value:function(e){postMessage({type:c.MessageType.PROGRESS_INIT,expectedFrames:e})}},{key:"progressUpdate",value:function(e,t){postMessage({type:c.MessageType.PROGRESS_UPDATE,currentFrame:e,preview:t})}},{key:"onMessage",value:function(){var e=(0,r.Z)(d().mark((function e(t){var i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.data,e.t0=i.type,e.next=e.t0===c.MessageType.FILE_IN?4:16;break;case 4:return console.debug("Hello from the worker!"),e.next=7,m.fromFile(i.osdFile);case 7:return this.osdReader=e.sent,console.debug("Got OSD reader"),e.next=11,v.fromFiles(i.fontFiles);case 11:return this.fontPack=e.sent,console.debug("Got font pack"),console.debug("Starting processor..."),this.processor.processFile(i.videoFile),e.abrupt("break",17);case 16:throw new Error("Unknown message type received");case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();new g}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.m=e,i.x=function(){var e=i.O(void 0,[893],(function(){return i(9287)}));return e=i.O(e)},function(){var e=[];i.O=function(t,n,r,s){if(!n){var o=1/0;for(h=0;h<e.length;h++){n=e[h][0],r=e[h][1],s=e[h][2];for(var a=!0,d=0;d<n.length;d++)(!1&s||o>=s)&&Object.keys(i.O).every((function(e){return i.O[e](n[d])}))?n.splice(d--,1):(a=!1,s<o&&(o=s));if(a){e.splice(h--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[n,r,s]}}(),i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,n){return i.f[n](e,t),t}),[]))},i.u=function(e){return"static/js/"+e+".91187f4f.chunk.js"},i.miniCssF=function(e){},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",function(){var e={287:1};i.f.i=function(t,n){e[t]||importScripts(i.p+i.u(t))};var t=self.webpackChunkwtfos_configurator=self.webpackChunkwtfos_configurator||[],n=t.push.bind(t);t.push=function(t){var r=t[0],s=t[1],o=t[2];for(var a in s)i.o(s,a)&&(i.m[a]=s[a]);for(o&&o(i);r.length;)e[r.pop()]=1;n(t)}}(),function(){var e=i.x;i.x=function(){return i.e(893).then(e)}}();i.x()}();
//# sourceMappingURL=287.3d667067.chunk.js.map